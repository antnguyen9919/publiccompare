{"version":3,"file":"explore.ec7deb84f65ee765b2e6.js","sources":["webpack:///./node_modules/lodash/_baseHas.js","webpack:///./node_modules/lodash/has.js","webpack:///./node_modules/lodash/negate.js","webpack:///./node_modules/lodash/omitBy.js","webpack:///./node_modules/lodash/pickBy.js","webpack:///./public/app/features/explore/ElapsedTime.tsx","webpack:///./public/app/features/explore/ErrorContainer.tsx","webpack:///./public/app/features/explore/Explore.tsx","webpack:///./public/app/features/explore/ExploreGraphPanel.tsx","webpack:///./public/app/features/explore/ExploreTimeControls.tsx","webpack:///./public/app/features/explore/ExploreToolbar.tsx","webpack:///./public/app/features/explore/LiveLogs.tsx","webpack:///./public/app/features/explore/LiveTailButton.tsx","webpack:///./public/app/features/explore/Logs.tsx","webpack:///./public/app/features/explore/LogsContainer.tsx","webpack:///./public/app/features/explore/NoDataSourceCallToAction.tsx","webpack:///./public/app/features/explore/QueryEditor.tsx","webpack:///./public/app/features/explore/QueryRow.tsx","webpack:///./public/app/features/explore/QueryRowActions.tsx","webpack:///./public/app/features/explore/QueryRows.tsx","webpack:///./public/app/features/explore/ResponsiveButton.tsx","webpack:///./public/app/features/explore/RunButton.tsx","webpack:///./public/app/features/explore/TableContainer.tsx","webpack:///./public/app/features/explore/TimeSyncButton.tsx","webpack:///./public/app/features/explore/Wrapper.tsx","webpack:///./public/app/features/explore/useLiveTailControls.ts","webpack:///./public/app/features/explore/utils/LogsCrossFadeTransition.tsx"],"sourcesContent":["/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.has` without support for deep paths.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {Array|string} key The key to check.\n * @returns {boolean} Returns `true` if `key` exists, else `false`.\n */\nfunction baseHas(object, key) {\n  return object != null && hasOwnProperty.call(object, key);\n}\n\nmodule.exports = baseHas;\n","var baseHas = require('./_baseHas'),\n    hasPath = require('./_hasPath');\n\n/**\n * Checks if `path` is a direct property of `object`.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n * @example\n *\n * var object = { 'a': { 'b': 2 } };\n * var other = _.create({ 'a': _.create({ 'b': 2 }) });\n *\n * _.has(object, 'a');\n * // => true\n *\n * _.has(object, 'a.b');\n * // => true\n *\n * _.has(object, ['a', 'b']);\n * // => true\n *\n * _.has(other, 'a');\n * // => false\n */\nfunction has(object, path) {\n  return object != null && hasPath(object, path, baseHas);\n}\n\nmodule.exports = has;\n","/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that negates the result of the predicate `func`. The\n * `func` predicate is invoked with the `this` binding and arguments of the\n * created function.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Function\n * @param {Function} predicate The predicate to negate.\n * @returns {Function} Returns the new negated function.\n * @example\n *\n * function isEven(n) {\n *   return n % 2 == 0;\n * }\n *\n * _.filter([1, 2, 3, 4, 5, 6], _.negate(isEven));\n * // => [1, 3, 5]\n */\nfunction negate(predicate) {\n  if (typeof predicate != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  return function() {\n    var args = arguments;\n    switch (args.length) {\n      case 0: return !predicate.call(this);\n      case 1: return !predicate.call(this, args[0]);\n      case 2: return !predicate.call(this, args[0], args[1]);\n      case 3: return !predicate.call(this, args[0], args[1], args[2]);\n    }\n    return !predicate.apply(this, args);\n  };\n}\n\nmodule.exports = negate;\n","var baseIteratee = require('./_baseIteratee'),\n    negate = require('./negate'),\n    pickBy = require('./pickBy');\n\n/**\n * The opposite of `_.pickBy`; this method creates an object composed of\n * the own and inherited enumerable string keyed properties of `object` that\n * `predicate` doesn't return truthy for. The predicate is invoked with two\n * arguments: (value, key).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The source object.\n * @param {Function} [predicate=_.identity] The function invoked per property.\n * @returns {Object} Returns the new object.\n * @example\n *\n * var object = { 'a': 1, 'b': '2', 'c': 3 };\n *\n * _.omitBy(object, _.isNumber);\n * // => { 'b': '2' }\n */\nfunction omitBy(object, predicate) {\n  return pickBy(object, negate(baseIteratee(predicate)));\n}\n\nmodule.exports = omitBy;\n","var arrayMap = require('./_arrayMap'),\n    baseIteratee = require('./_baseIteratee'),\n    basePickBy = require('./_basePickBy'),\n    getAllKeysIn = require('./_getAllKeysIn');\n\n/**\n * Creates an object composed of the `object` properties `predicate` returns\n * truthy for. The predicate is invoked with two arguments: (value, key).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The source object.\n * @param {Function} [predicate=_.identity] The function invoked per property.\n * @returns {Object} Returns the new object.\n * @example\n *\n * var object = { 'a': 1, 'b': '2', 'c': 3 };\n *\n * _.pickBy(object, _.isNumber);\n * // => { 'a': 1, 'c': 3 }\n */\nfunction pickBy(object, predicate) {\n  if (object == null) {\n    return {};\n  }\n  var props = arrayMap(getAllKeysIn(object), function(prop) {\n    return [prop];\n  });\n  predicate = baseIteratee(predicate);\n  return basePickBy(object, props, function(value, path) {\n    return predicate(value, path[0]);\n  });\n}\n\nmodule.exports = pickBy;\n","import React, { PureComponent } from 'react';\nimport { toDuration } from '@grafana/data';\n\nconst INTERVAL = 150;\n\nexport interface Props {\n  time?: number;\n  // Use this to reset the timer. Any value is allowed just need to be !== from the previous.\n  // Keep in mind things like [] !== [] or {} !== {}.\n  resetKey?: any;\n  className?: string;\n  humanize?: boolean;\n}\n\nexport interface State {\n  elapsed: number;\n}\n\n/**\n * Shows an incremental time ticker of elapsed time from some event.\n */\nexport default class ElapsedTime extends PureComponent<Props, State> {\n  offset: number;\n  timer: number;\n\n  state = {\n    elapsed: 0,\n  };\n\n  start() {\n    this.offset = Date.now();\n    this.timer = window.setInterval(this.tick, INTERVAL);\n  }\n\n  tick = () => {\n    const jetzt = Date.now();\n    const elapsed = jetzt - this.offset;\n    this.setState({ elapsed });\n  };\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.time) {\n      clearInterval(this.timer);\n    } else if (this.props.time) {\n      this.start();\n    }\n\n    if (nextProps.resetKey !== this.props.resetKey) {\n      clearInterval(this.timer);\n      this.start();\n    }\n  }\n\n  componentDidMount() {\n    this.start();\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.timer);\n  }\n\n  render() {\n    const { elapsed } = this.state;\n    const { className, time, humanize } = this.props;\n    const value = (time || elapsed) / 1000;\n    let displayValue = `${value.toFixed(1)}s`;\n    if (humanize) {\n      const duration = toDuration(elapsed);\n      const hours = duration.hours();\n      const minutes = duration.minutes();\n      const seconds = duration.seconds();\n      displayValue = hours ? `${hours}h ${minutes}m ${seconds}s` : minutes ? ` ${minutes}m ${seconds}s` : `${seconds}s`;\n    }\n    return <span className={`elapsed-time ${className}`}>{displayValue}</span>;\n  }\n}\n","import React, { FunctionComponent } from 'react';\nimport { DataQueryError } from '@grafana/data';\nimport { FadeIn } from 'app/core/components/Animations/FadeIn';\nimport { getFirstQueryErrorWithoutRefId, getValueWithRefId } from 'app/core/utils/explore';\n\ninterface Props {\n  queryErrors?: DataQueryError[];\n}\n\nexport const ErrorContainer: FunctionComponent<Props> = props => {\n  const { queryErrors } = props;\n  const refId = getValueWithRefId(queryErrors);\n  const queryError = refId ? null : getFirstQueryErrorWithoutRefId(queryErrors);\n  const showError = queryError ? true : false;\n  const duration = showError ? 100 : 10;\n  const message = queryError ? queryError.message : null;\n\n  return (\n    <FadeIn in={showError} duration={duration}>\n      <div className=\"alert-container\">\n        <div className=\"alert-error alert\">\n          <div className=\"alert-icon\">\n            <i className=\"fa fa-exclamation-triangle\" />\n          </div>\n          <div className=\"alert-body\">\n            <div className=\"alert-title\">{message}</div>\n          </div>\n        </div>\n      </div>\n    </FadeIn>\n  );\n};\n","// Libraries\nimport React from 'react';\nimport { hot } from 'react-hot-loader';\nimport { css } from 'emotion';\nimport { connect } from 'react-redux';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport memoizeOne from 'memoize-one';\n\n// Services & Utils\nimport store from 'app/core/store';\n// Components\nimport { ErrorBoundaryAlert } from '@grafana/ui';\nimport LogsContainer from './LogsContainer';\nimport QueryRows from './QueryRows';\nimport TableContainer from './TableContainer';\n// Actions\nimport {\n  changeSize,\n  initializeExplore,\n  modifyQueries,\n  scanStart,\n  setQueries,\n  refreshExplore,\n  updateTimeRange,\n  toggleGraph,\n  addQueryRow,\n} from './state/actions';\n// Types\nimport {\n  DataQuery,\n  DataSourceApi,\n  PanelData,\n  RawTimeRange,\n  TimeRange,\n  GraphSeriesXY,\n  TimeZone,\n  AbsoluteTimeRange,\n  LoadingState,\n} from '@grafana/data';\n\nimport {\n  ExploreItemState,\n  ExploreUrlState,\n  ExploreId,\n  ExploreUpdateState,\n  ExploreUIState,\n  ExploreMode,\n} from 'app/types/explore';\nimport { StoreState } from 'app/types';\nimport {\n  ensureQueries,\n  DEFAULT_RANGE,\n  DEFAULT_UI_STATE,\n  getTimeRangeFromUrl,\n  getTimeRange,\n  lastUsedDatasourceKeyForOrgId,\n} from 'app/core/utils/explore';\nimport { Emitter } from 'app/core/utils/emitter';\nimport { ExploreToolbar } from './ExploreToolbar';\nimport { NoDataSourceCallToAction } from './NoDataSourceCallToAction';\nimport { getTimeZone } from '../profile/state/selectors';\nimport { ErrorContainer } from './ErrorContainer';\nimport { scanStopAction } from './state/actionTypes';\nimport { ExploreGraphPanel } from './ExploreGraphPanel';\n\nconst getStyles = memoizeOne(() => {\n  return {\n    logsMain: css`\n      label: logsMain;\n      // Is needed for some transition animations to work.\n      position: relative;\n    `,\n    exploreAddButton: css`\n      margin-top: 1em;\n    `,\n  };\n});\n\ninterface ExploreProps {\n  changeSize: typeof changeSize;\n  datasourceInstance: DataSourceApi;\n  datasourceMissing: boolean;\n  exploreId: ExploreId;\n  initializeExplore: typeof initializeExplore;\n  initialized: boolean;\n  modifyQueries: typeof modifyQueries;\n  update: ExploreUpdateState;\n  refreshExplore: typeof refreshExplore;\n  scanning?: boolean;\n  scanRange?: RawTimeRange;\n  scanStart: typeof scanStart;\n  scanStopAction: typeof scanStopAction;\n  setQueries: typeof setQueries;\n  split: boolean;\n  queryKeys: string[];\n  initialDatasource: string;\n  initialQueries: DataQuery[];\n  initialRange: TimeRange;\n  mode: ExploreMode;\n  initialUI: ExploreUIState;\n  isLive: boolean;\n  syncedTimes: boolean;\n  updateTimeRange: typeof updateTimeRange;\n  graphResult?: GraphSeriesXY[];\n  loading?: boolean;\n  absoluteRange: AbsoluteTimeRange;\n  showingGraph?: boolean;\n  showingTable?: boolean;\n  timeZone?: TimeZone;\n  onHiddenSeriesChanged?: (hiddenSeries: string[]) => void;\n  toggleGraph: typeof toggleGraph;\n  queryResponse: PanelData;\n  originPanelId: number;\n  addQueryRow: typeof addQueryRow;\n}\n\n/**\n * Explore provides an area for quick query iteration for a given datasource.\n * Once a datasource is selected it populates the query section at the top.\n * When queries are run, their results are being displayed in the main section.\n * The datasource determines what kind of query editor it brings, and what kind\n * of results viewers it supports. The state is managed entirely in Redux.\n *\n * SPLIT VIEW\n *\n * Explore can have two Explore areas side-by-side. This is handled in `Wrapper.tsx`.\n * Since there can be multiple Explores (e.g., left and right) each action needs\n * the `exploreId` as first parameter so that the reducer knows which Explore state\n * is affected.\n *\n * DATASOURCE REQUESTS\n *\n * A click on Run Query creates transactions for all DataQueries for all expanded\n * result viewers. New runs are discarding previous runs. Upon completion a transaction\n * saves the result. The result viewers construct their data from the currently existing\n * transactions.\n *\n * The result viewers determine some of the query options sent to the datasource, e.g.,\n * `format`, to indicate eventual transformations by the datasources' result transformers.\n */\nexport class Explore extends React.PureComponent<ExploreProps> {\n  el: any;\n  exploreEvents: Emitter;\n\n  constructor(props: ExploreProps) {\n    super(props);\n    this.exploreEvents = new Emitter();\n  }\n\n  componentDidMount() {\n    const {\n      initialized,\n      exploreId,\n      initialDatasource,\n      initialQueries,\n      initialRange,\n      mode,\n      initialUI,\n      originPanelId,\n    } = this.props;\n    const width = this.el ? this.el.offsetWidth : 0;\n\n    // initialize the whole explore first time we mount and if browser history contains a change in datasource\n    if (!initialized) {\n      this.props.initializeExplore(\n        exploreId,\n        initialDatasource,\n        initialQueries,\n        initialRange,\n        mode,\n        width,\n        this.exploreEvents,\n        initialUI,\n        originPanelId\n      );\n    }\n  }\n\n  componentWillUnmount() {\n    this.exploreEvents.removeAllListeners();\n  }\n\n  componentDidUpdate(prevProps: ExploreProps) {\n    this.refreshExplore();\n  }\n\n  getRef = (el: any) => {\n    this.el = el;\n  };\n\n  onChangeTime = (rawRange: RawTimeRange) => {\n    const { updateTimeRange, exploreId } = this.props;\n    updateTimeRange({ exploreId, rawRange });\n  };\n\n  // Use this in help pages to set page to a single query\n  onClickExample = (query: DataQuery) => {\n    this.props.setQueries(this.props.exploreId, [query]);\n  };\n\n  onClickFilterLabel = (key: string, value: string) => {\n    this.onModifyQueries({ type: 'ADD_FILTER', key, value });\n  };\n\n  onClickFilterOutLabel = (key: string, value: string) => {\n    this.onModifyQueries({ type: 'ADD_FILTER_OUT', key, value });\n  };\n\n  onClickAddQueryRowButton = () => {\n    const { exploreId, queryKeys } = this.props;\n    this.props.addQueryRow(exploreId, queryKeys.length);\n  };\n\n  onModifyQueries = (action: any, index?: number) => {\n    const { datasourceInstance } = this.props;\n    if (datasourceInstance?.modifyQuery) {\n      const modifier = (queries: DataQuery, modification: any) =>\n        datasourceInstance.modifyQuery!(queries, modification);\n      this.props.modifyQueries(this.props.exploreId, action, modifier, index);\n    }\n  };\n\n  onResize = (size: { height: number; width: number }) => {\n    this.props.changeSize(this.props.exploreId, size);\n  };\n\n  onStartScanning = () => {\n    // Scanner will trigger a query\n    this.props.scanStart(this.props.exploreId);\n  };\n\n  onStopScanning = () => {\n    this.props.scanStopAction({ exploreId: this.props.exploreId });\n  };\n\n  onToggleGraph = (showingGraph: boolean) => {\n    const { toggleGraph, exploreId } = this.props;\n    toggleGraph(exploreId, showingGraph);\n  };\n\n  onUpdateTimeRange = (absoluteRange: AbsoluteTimeRange) => {\n    const { exploreId, updateTimeRange } = this.props;\n    updateTimeRange({ exploreId, absoluteRange });\n  };\n\n  refreshExplore = () => {\n    const { exploreId, update } = this.props;\n\n    if (update.queries || update.ui || update.range || update.datasource || update.mode) {\n      this.props.refreshExplore(exploreId);\n    }\n  };\n\n  renderEmptyState = () => {\n    return (\n      <div className=\"explore-container\">\n        <NoDataSourceCallToAction />\n      </div>\n    );\n  };\n\n  render() {\n    const {\n      datasourceInstance,\n      datasourceMissing,\n      exploreId,\n      split,\n      queryKeys,\n      mode,\n      graphResult,\n      loading,\n      absoluteRange,\n      showingGraph,\n      showingTable,\n      timeZone,\n      queryResponse,\n      syncedTimes,\n      isLive,\n    } = this.props;\n    const exploreClass = split ? 'explore explore-split' : 'explore';\n    const styles = getStyles();\n    const StartPage = datasourceInstance?.components?.ExploreStartPage;\n    const showStartPage = !queryResponse || queryResponse.state === LoadingState.NotStarted;\n\n    return (\n      <div className={exploreClass} ref={this.getRef}>\n        <ExploreToolbar exploreId={exploreId} onChangeTime={this.onChangeTime} />\n        {datasourceMissing ? this.renderEmptyState() : null}\n        {datasourceInstance && (\n          <div className=\"explore-container\">\n            <QueryRows exploreEvents={this.exploreEvents} exploreId={exploreId} queryKeys={queryKeys} />\n            <div className=\"gf-form\">\n              <button\n                aria-label=\"Add row button\"\n                className={`gf-form-label gf-form-label--btn ${styles.exploreAddButton}`}\n                onClick={this.onClickAddQueryRowButton}\n                disabled={isLive}\n              >\n                <i className={'fa fa-fw fa-plus icon-margin-right'} />\n                <span className=\"btn-title\">{'\\xA0' + 'Add query'}</span>\n              </button>\n            </div>\n            <ErrorContainer queryErrors={queryResponse.error ? [queryResponse.error] : undefined} />\n            <AutoSizer onResize={this.onResize} disableHeight>\n              {({ width }) => {\n                if (width === 0) {\n                  return null;\n                }\n\n                return (\n                  <main className={`m-t-2 ${styles.logsMain}`} style={{ width }}>\n                    <ErrorBoundaryAlert>\n                      {showStartPage && StartPage && (\n                        <div className=\"grafana-info-box grafana-info-box--max-lg\">\n                          <StartPage\n                            onClickExample={this.onClickExample}\n                            datasource={datasourceInstance}\n                            exploreMode={mode}\n                          />\n                        </div>\n                      )}\n                      {!showStartPage && (\n                        <>\n                          {mode === ExploreMode.Metrics && (\n                            <ExploreGraphPanel\n                              series={graphResult}\n                              width={width}\n                              loading={loading}\n                              absoluteRange={absoluteRange}\n                              isStacked={false}\n                              showPanel={true}\n                              showingGraph={showingGraph}\n                              showingTable={showingTable}\n                              timeZone={timeZone}\n                              onToggleGraph={this.onToggleGraph}\n                              onUpdateTimeRange={this.onUpdateTimeRange}\n                              showBars={false}\n                              showLines={true}\n                            />\n                          )}\n                          {mode === ExploreMode.Metrics && (\n                            <TableContainer width={width} exploreId={exploreId} onClickCell={this.onClickFilterLabel} />\n                          )}\n                          {mode === ExploreMode.Logs && (\n                            <LogsContainer\n                              width={width}\n                              exploreId={exploreId}\n                              syncedTimes={syncedTimes}\n                              onClickFilterLabel={this.onClickFilterLabel}\n                              onClickFilterOutLabel={this.onClickFilterOutLabel}\n                              onStartScanning={this.onStartScanning}\n                              onStopScanning={this.onStopScanning}\n                            />\n                          )}\n                        </>\n                      )}\n                    </ErrorBoundaryAlert>\n                  </main>\n                );\n              }}\n            </AutoSizer>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nconst ensureQueriesMemoized = memoizeOne(ensureQueries);\nconst getTimeRangeFromUrlMemoized = memoizeOne(getTimeRangeFromUrl);\n\nfunction mapStateToProps(state: StoreState, { exploreId }: ExploreProps): Partial<ExploreProps> {\n  const explore = state.explore;\n  const { split, syncedTimes } = explore;\n  const item: ExploreItemState = explore[exploreId];\n  const timeZone = getTimeZone(state.user);\n  const {\n    datasourceInstance,\n    datasourceMissing,\n    initialized,\n    queryKeys,\n    urlState,\n    update,\n    isLive,\n    supportedModes,\n    mode,\n    graphResult,\n    loading,\n    showingGraph,\n    showingTable,\n    absoluteRange,\n    queryResponse,\n  } = item;\n\n  const { datasource, queries, range: urlRange, mode: urlMode, ui, originPanelId } = (urlState ||\n    {}) as ExploreUrlState;\n  const initialDatasource = datasource || store.get(lastUsedDatasourceKeyForOrgId(state.user.orgId));\n  const initialQueries: DataQuery[] = ensureQueriesMemoized(queries);\n  const initialRange = urlRange\n    ? getTimeRangeFromUrlMemoized(urlRange, timeZone)\n    : getTimeRange(timeZone, DEFAULT_RANGE);\n\n  let newMode: ExploreMode | undefined;\n\n  if (supportedModes.length) {\n    const urlModeIsValid = supportedModes.includes(urlMode);\n    const modeStateIsValid = supportedModes.includes(mode);\n\n    if (modeStateIsValid) {\n      newMode = mode;\n    } else if (urlModeIsValid) {\n      newMode = urlMode;\n    } else {\n      newMode = supportedModes[0];\n    }\n  } else {\n    newMode = [ExploreMode.Metrics, ExploreMode.Logs].includes(urlMode) ? urlMode : undefined;\n  }\n\n  const initialUI = ui || DEFAULT_UI_STATE;\n\n  return {\n    datasourceInstance,\n    datasourceMissing,\n    initialized,\n    split,\n    queryKeys,\n    update,\n    initialDatasource,\n    initialQueries,\n    initialRange,\n    mode: newMode,\n    initialUI,\n    isLive,\n    graphResult,\n    loading,\n    showingGraph,\n    showingTable,\n    absoluteRange,\n    queryResponse,\n    originPanelId,\n    syncedTimes,\n    timeZone,\n  };\n}\n\nconst mapDispatchToProps: Partial<ExploreProps> = {\n  changeSize,\n  initializeExplore,\n  modifyQueries,\n  refreshExplore,\n  scanStart,\n  scanStopAction,\n  setQueries,\n  updateTimeRange,\n  toggleGraph,\n  addQueryRow,\n};\n\nexport default hot(module)(\n  // @ts-ignore\n  connect(mapStateToProps, mapDispatchToProps)(Explore)\n) as React.ComponentType<{ exploreId: ExploreId }>;\n","import React, { PureComponent } from 'react';\nimport { css, cx } from 'emotion';\nimport { GrafanaTheme, TimeZone, AbsoluteTimeRange, GraphSeriesXY, dateTimeForTimeZone } from '@grafana/data';\n\nimport {\n  selectThemeVariant,\n  Themeable,\n  GraphWithLegend,\n  LegendDisplayMode,\n  withTheme,\n  Collapse,\n  GraphSeriesToggler,\n  GraphSeriesTogglerAPI,\n  Chart,\n} from '@grafana/ui';\n\nconst MAX_NUMBER_OF_TIME_SERIES = 20;\n\nconst getStyles = (theme: GrafanaTheme) => ({\n  timeSeriesDisclaimer: css`\n    label: time-series-disclaimer;\n    width: 300px;\n    margin: ${theme.spacing.sm} auto;\n    padding: 10px 0;\n    border-radius: ${theme.border.radius.md};\n    text-align: center;\n    background-color: ${selectThemeVariant({ light: theme.colors.white, dark: theme.colors.dark4 }, theme.type)};\n  `,\n  disclaimerIcon: css`\n    label: disclaimer-icon;\n    color: ${theme.colors.yellow};\n    margin-right: ${theme.spacing.xs};\n  `,\n  showAllTimeSeries: css`\n    label: show-all-time-series;\n    cursor: pointer;\n    color: ${theme.colors.linkExternal};\n  `,\n});\n\ninterface Props extends Themeable {\n  series?: GraphSeriesXY[];\n  width: number;\n  absoluteRange: AbsoluteTimeRange;\n  loading?: boolean;\n  showPanel: boolean;\n  showBars: boolean;\n  showLines: boolean;\n  isStacked: boolean;\n  showingGraph?: boolean;\n  showingTable?: boolean;\n  timeZone?: TimeZone;\n  onUpdateTimeRange: (absoluteRange: AbsoluteTimeRange) => void;\n  onToggleGraph?: (showingGraph: boolean) => void;\n  onHiddenSeriesChanged?: (hiddenSeries: string[]) => void;\n}\n\ninterface State {\n  hiddenSeries: string[];\n  showAllTimeSeries: boolean;\n}\n\nclass UnThemedExploreGraphPanel extends PureComponent<Props, State> {\n  state: State = {\n    hiddenSeries: [],\n    showAllTimeSeries: false,\n  };\n\n  onShowAllTimeSeries = () => {\n    this.setState({\n      showAllTimeSeries: true,\n    });\n  };\n\n  onClickGraphButton = () => {\n    const { onToggleGraph, showingGraph } = this.props;\n    if (onToggleGraph) {\n      onToggleGraph(showingGraph ?? false);\n    }\n  };\n\n  onChangeTime = (from: number, to: number) => {\n    const { onUpdateTimeRange } = this.props;\n    onUpdateTimeRange({ from, to });\n  };\n\n  renderGraph = () => {\n    const {\n      width,\n      series,\n      onHiddenSeriesChanged,\n      timeZone,\n      absoluteRange,\n      showPanel,\n      showingGraph,\n      showingTable,\n      showBars,\n      showLines,\n      isStacked,\n    } = this.props;\n    const { showAllTimeSeries } = this.state;\n\n    if (!series) {\n      return null;\n    }\n\n    const timeRange = {\n      from: dateTimeForTimeZone(timeZone, absoluteRange.from),\n      to: dateTimeForTimeZone(timeZone, absoluteRange.to),\n      raw: {\n        from: dateTimeForTimeZone(timeZone, absoluteRange.from),\n        to: dateTimeForTimeZone(timeZone, absoluteRange.to),\n      },\n    };\n    const height = showPanel === false ? 100 : showingGraph && showingTable ? 200 : 400;\n    const lineWidth = showLines ? 1 : 5;\n    const seriesToShow = showAllTimeSeries ? series : series.slice(0, MAX_NUMBER_OF_TIME_SERIES);\n\n    return (\n      <GraphSeriesToggler series={seriesToShow} onHiddenSeriesChanged={onHiddenSeriesChanged}>\n        {({ onSeriesToggle, toggledSeries }: GraphSeriesTogglerAPI) => {\n          return (\n            <GraphWithLegend\n              displayMode={LegendDisplayMode.List}\n              height={height}\n              isLegendVisible={true}\n              placement={'under'}\n              width={width}\n              timeRange={timeRange}\n              timeZone={timeZone}\n              showBars={showBars}\n              showLines={showLines}\n              showPoints={false}\n              onToggleSort={() => {}}\n              series={toggledSeries}\n              isStacked={isStacked}\n              lineWidth={lineWidth}\n              onSeriesToggle={onSeriesToggle}\n              onHorizontalRegionSelected={this.onChangeTime}\n            >\n              {/* For logs we are using mulit mode until we refactor logs histogram to use barWidth instead of lineWidth to render bars */}\n              <Chart.Tooltip mode={showBars ? 'multi' : 'single'} />\n            </GraphWithLegend>\n          );\n        }}\n      </GraphSeriesToggler>\n    );\n  };\n\n  render() {\n    const { series, showPanel, showingGraph, loading, theme } = this.props;\n    const { showAllTimeSeries } = this.state;\n    const style = getStyles(theme);\n\n    return (\n      <>\n        {series && series.length > MAX_NUMBER_OF_TIME_SERIES && !showAllTimeSeries && (\n          <div className={cx([style.timeSeriesDisclaimer])}>\n            <i className={cx(['fa fa-fw fa-warning', style.disclaimerIcon])} />\n            {`Showing only ${MAX_NUMBER_OF_TIME_SERIES} time series. `}\n            <span\n              className={cx([style.showAllTimeSeries])}\n              onClick={this.onShowAllTimeSeries}\n            >{`Show all ${series.length}`}</span>\n          </div>\n        )}\n\n        {showPanel && (\n          <Collapse\n            label=\"Graph\"\n            collapsible\n            isOpen={showingGraph}\n            loading={loading}\n            onToggle={this.onClickGraphButton}\n          >\n            {this.renderGraph()}\n          </Collapse>\n        )}\n\n        {!showPanel && this.renderGraph()}\n      </>\n    );\n  }\n}\n\nexport const ExploreGraphPanel = withTheme(UnThemedExploreGraphPanel);\nExploreGraphPanel.displayName = 'ExploreGraphPanel';\n","// Libaries\nimport React, { Component } from 'react';\n\n// Types\nimport { ExploreId } from 'app/types';\nimport { TimeRange, TimeZone, RawTimeRange, dateTimeForTimeZone } from '@grafana/data';\n\n// State\n\n// Components\nimport { TimeSyncButton } from './TimeSyncButton';\nimport { TimePickerWithHistory } from 'app/core/components/TimePicker/TimePickerWithHistory';\n\n// Utils & Services\nimport { getShiftedTimeRange, getZoomedTimeRange } from 'app/core/utils/timePicker';\n\nexport interface Props {\n  exploreId: ExploreId;\n  hideText?: boolean;\n  range: TimeRange;\n  timeZone: TimeZone;\n  splitted: boolean;\n  syncedTimes: boolean;\n  onChangeTimeSync: () => void;\n  onChangeTime: (range: RawTimeRange) => void;\n}\n\nexport class ExploreTimeControls extends Component<Props> {\n  onMoveTimePicker = (direction: number) => {\n    const { range, onChangeTime, timeZone } = this.props;\n    const { from, to } = getShiftedTimeRange(direction, range);\n    const nextTimeRange = {\n      from: dateTimeForTimeZone(timeZone, from),\n      to: dateTimeForTimeZone(timeZone, to),\n    };\n\n    onChangeTime(nextTimeRange);\n  };\n\n  onMoveForward = () => this.onMoveTimePicker(1);\n  onMoveBack = () => this.onMoveTimePicker(-1);\n\n  onChangeTimePicker = (timeRange: TimeRange) => {\n    this.props.onChangeTime(timeRange.raw);\n  };\n\n  onZoom = () => {\n    const { range, onChangeTime, timeZone } = this.props;\n    const { from, to } = getZoomedTimeRange(range, 2);\n    const nextTimeRange = {\n      from: dateTimeForTimeZone(timeZone, from),\n      to: dateTimeForTimeZone(timeZone, to),\n    };\n\n    onChangeTime(nextTimeRange);\n  };\n\n  render() {\n    const { range, timeZone, splitted, syncedTimes, onChangeTimeSync, hideText } = this.props;\n    const timeSyncButton = splitted ? <TimeSyncButton onClick={onChangeTimeSync} isSynced={syncedTimes} /> : undefined;\n    const timePickerCommonProps = {\n      value: range,\n      timeZone,\n      onMoveBackward: this.onMoveBack,\n      onMoveForward: this.onMoveForward,\n      onZoom: this.onZoom,\n      hideText,\n    };\n\n    return (\n      <TimePickerWithHistory\n        {...timePickerCommonProps}\n        timeSyncButton={timeSyncButton}\n        isSynced={syncedTimes}\n        onChange={this.onChangeTimePicker}\n      />\n    );\n  }\n}\n","import omitBy from 'lodash/omitBy';\nimport React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { hot } from 'react-hot-loader';\nimport memoizeOne from 'memoize-one';\nimport classNames from 'classnames';\nimport { css } from 'emotion';\n\nimport { ExploreId, ExploreItemState, ExploreMode } from 'app/types/explore';\nimport { ToggleButtonGroup, ToggleButton, Tooltip, ButtonSelect, SetInterval } from '@grafana/ui';\nimport { RawTimeRange, TimeZone, TimeRange, DataQuery } from '@grafana/data';\nimport { DataSourcePicker } from 'app/core/components/Select/DataSourcePicker';\nimport { StoreState } from 'app/types/store';\nimport {\n  changeDatasource,\n  clearQueries,\n  splitClose,\n  runQueries,\n  splitOpen,\n  syncTimes,\n  changeRefreshInterval,\n  changeMode,\n} from './state/actions';\nimport { updateLocation } from 'app/core/actions';\nimport { getTimeZone } from '../profile/state/selectors';\nimport { getDashboardSrv } from '../dashboard/services/DashboardSrv';\nimport kbn from '../../core/utils/kbn';\nimport { ExploreTimeControls } from './ExploreTimeControls';\nimport { LiveTailButton } from './LiveTailButton';\nimport { ResponsiveButton } from './ResponsiveButton';\nimport { RunButton } from './RunButton';\nimport { LiveTailControls } from './useLiveTailControls';\nimport { getExploreDatasources } from './state/selectors';\nimport { setDashboardQueriesToUpdateOnLoad } from '../dashboard/state/actions';\n\nconst getStyles = memoizeOne(() => {\n  return {\n    liveTailButtons: css`\n      margin-left: 10px;\n      @media (max-width: 1110px) {\n        margin-left: 4px;\n      }\n    `,\n  };\n});\n\ninterface OwnProps {\n  exploreId: ExploreId;\n  onChangeTime: (range: RawTimeRange, changedByScanner?: boolean) => void;\n}\n\ninterface StateProps {\n  datasourceMissing: boolean;\n  loading: boolean;\n  range: TimeRange;\n  timeZone: TimeZone;\n  splitted: boolean;\n  syncedTimes: boolean;\n  refreshInterval?: string;\n  supportedModes: ExploreMode[];\n  selectedMode: ExploreMode;\n  hasLiveOption: boolean;\n  isLive: boolean;\n  isPaused: boolean;\n  originPanelId?: number;\n  queries: DataQuery[];\n  datasourceLoading?: boolean;\n  containerWidth: number;\n  datasourceName?: string;\n}\n\ninterface DispatchProps {\n  changeDatasource: typeof changeDatasource;\n  clearAll: typeof clearQueries;\n  runQueries: typeof runQueries;\n  closeSplit: typeof splitClose;\n  split: typeof splitOpen;\n  syncTimes: typeof syncTimes;\n  changeRefreshInterval: typeof changeRefreshInterval;\n  changeMode: typeof changeMode;\n  updateLocation: typeof updateLocation;\n  setDashboardQueriesToUpdateOnLoad: typeof setDashboardQueriesToUpdateOnLoad;\n}\n\ntype Props = StateProps & DispatchProps & OwnProps;\n\nexport class UnConnectedExploreToolbar extends PureComponent<Props> {\n  onChangeDatasource = async (option: { value: any }) => {\n    this.props.changeDatasource(this.props.exploreId, option.value);\n  };\n\n  onClearAll = () => {\n    this.props.clearAll(this.props.exploreId);\n  };\n\n  onRunQuery = () => {\n    return this.props.runQueries(this.props.exploreId);\n  };\n\n  onChangeRefreshInterval = (item: string) => {\n    const { changeRefreshInterval, exploreId } = this.props;\n    changeRefreshInterval(exploreId, item);\n  };\n\n  onModeChange = (mode: ExploreMode) => {\n    const { changeMode, exploreId } = this.props;\n    changeMode(exploreId, mode);\n  };\n\n  onChangeTimeSync = () => {\n    const { syncTimes, exploreId } = this.props;\n    syncTimes(exploreId);\n  };\n\n  returnToPanel = async ({ withChanges = false } = {}) => {\n    const { originPanelId, queries } = this.props;\n\n    const dashboardSrv = getDashboardSrv();\n    const dash = dashboardSrv.getCurrent();\n    const titleSlug = kbn.slugifyForUrl(dash.title);\n\n    if (withChanges) {\n      this.props.setDashboardQueriesToUpdateOnLoad(originPanelId, this.cleanQueries(queries));\n    }\n\n    const dashViewOptions = {\n      fullscreen: withChanges || dash.meta.fullscreen,\n      edit: withChanges || dash.meta.isEditing,\n    };\n\n    this.props.updateLocation({\n      path: `/d/${dash.uid}/:${titleSlug}`,\n      query: {\n        ...omitBy(dashViewOptions, v => !v),\n        panelId: originPanelId,\n      },\n    });\n  };\n\n  // Remove explore specific parameters from queries\n  private cleanQueries(queries: DataQuery[]) {\n    return queries.map((query: DataQuery & { context?: string }) => {\n      delete query.context;\n      delete query.key;\n      return query;\n    });\n  }\n\n  getSelectedDatasource = () => {\n    const { datasourceName } = this.props;\n    const exploreDatasources = getExploreDatasources();\n    return datasourceName ? exploreDatasources.find(datasource => datasource.name === datasourceName) : undefined;\n  };\n\n  render() {\n    const {\n      datasourceMissing,\n      closeSplit,\n      exploreId,\n      loading,\n      range,\n      timeZone,\n      splitted,\n      syncedTimes,\n      refreshInterval,\n      onChangeTime,\n      split,\n      supportedModes,\n      selectedMode,\n      hasLiveOption,\n      isLive,\n      isPaused,\n      originPanelId,\n      datasourceLoading,\n      containerWidth,\n    } = this.props;\n\n    const styles = getStyles();\n    const originDashboardIsEditable = originPanelId && Number.isInteger(originPanelId);\n    const panelReturnClasses = classNames('btn', 'navbar-button', {\n      'btn--radius-right-0': originDashboardIsEditable,\n      'navbar-button navbar-button--border-right-0': originDashboardIsEditable,\n    });\n\n    const showSmallDataSourcePicker = (splitted ? containerWidth < 700 : containerWidth < 800) || false;\n    const showSmallTimePicker = splitted || containerWidth < 1210;\n\n    return (\n      <div className={splitted ? 'explore-toolbar splitted' : 'explore-toolbar'}>\n        <div className=\"explore-toolbar-item\">\n          <div className=\"explore-toolbar-header\">\n            <div className=\"explore-toolbar-header-title\">\n              {exploreId === 'left' && (\n                <span className=\"navbar-page-btn\">\n                  <i className=\"gicon gicon-explore\" />\n                  Explore\n                </span>\n              )}\n            </div>\n            {splitted && (\n              <a className=\"explore-toolbar-header-close\" onClick={() => closeSplit(exploreId)}>\n                <i className=\"fa fa-times fa-fw\" />\n              </a>\n            )}\n          </div>\n        </div>\n        <div className=\"explore-toolbar-item\">\n          <div className=\"explore-toolbar-content\">\n            {!datasourceMissing ? (\n              <div className=\"explore-toolbar-content-item\">\n                <div\n                  className={classNames(\n                    'explore-ds-picker',\n                    showSmallDataSourcePicker ? 'explore-ds-picker--small' : ''\n                  )}\n                >\n                  <DataSourcePicker\n                    onChange={this.onChangeDatasource}\n                    datasources={getExploreDatasources()}\n                    current={this.getSelectedDatasource()}\n                    showLoading={datasourceLoading}\n                    hideTextValue={showSmallDataSourcePicker}\n                  />\n                </div>\n                {supportedModes.length > 1 ? (\n                  <div className=\"query-type-toggle\">\n                    <ToggleButtonGroup label=\"\" transparent={true}>\n                      <ToggleButton\n                        key={ExploreMode.Metrics}\n                        value={ExploreMode.Metrics}\n                        onChange={this.onModeChange}\n                        selected={selectedMode === ExploreMode.Metrics}\n                      >\n                        {'Metrics'}\n                      </ToggleButton>\n                      <ToggleButton\n                        key={ExploreMode.Logs}\n                        value={ExploreMode.Logs}\n                        onChange={this.onModeChange}\n                        selected={selectedMode === ExploreMode.Logs}\n                      >\n                        {'Logs'}\n                      </ToggleButton>\n                    </ToggleButtonGroup>\n                  </div>\n                ) : null}\n              </div>\n            ) : null}\n\n            {originPanelId && Number.isInteger(originPanelId) && !splitted && (\n              <div className=\"explore-toolbar-content-item\">\n                <Tooltip content={'Return to panel'} placement=\"bottom\">\n                  <button className={panelReturnClasses} onClick={() => this.returnToPanel()}>\n                    <i className=\"fa fa-arrow-left\" />\n                  </button>\n                </Tooltip>\n                {originDashboardIsEditable && (\n                  <ButtonSelect\n                    className=\"navbar-button--attached btn--radius-left-0$\"\n                    options={[{ label: 'Return to panel with changes', value: '' }]}\n                    onChange={() => this.returnToPanel({ withChanges: true })}\n                    maxMenuHeight={380}\n                  />\n                )}\n              </div>\n            )}\n\n            {exploreId === 'left' && !splitted ? (\n              <div className=\"explore-toolbar-content-item explore-icon-align\">\n                <ResponsiveButton\n                  splitted={splitted}\n                  title=\"Split\"\n                  onClick={split}\n                  iconClassName=\"fa fa-fw fa-columns icon-margin-right\"\n                  disabled={isLive}\n                />\n              </div>\n            ) : null}\n            {!isLive && (\n              <div className=\"explore-toolbar-content-item\">\n                <ExploreTimeControls\n                  exploreId={exploreId}\n                  range={range}\n                  timeZone={timeZone}\n                  onChangeTime={onChangeTime}\n                  splitted={splitted}\n                  syncedTimes={syncedTimes}\n                  onChangeTimeSync={this.onChangeTimeSync}\n                  hideText={showSmallTimePicker}\n                />\n              </div>\n            )}\n\n            {!isLive && (\n              <div className=\"explore-toolbar-content-item explore-icon-align\">\n                <ResponsiveButton\n                  splitted={splitted}\n                  title=\"Clear All\"\n                  onClick={this.onClearAll}\n                  iconClassName=\"fa fa-fw fa-trash icon-margin-right\"\n                />\n              </div>\n            )}\n            <div className=\"explore-toolbar-content-item\">\n              <RunButton\n                refreshInterval={refreshInterval}\n                onChangeRefreshInterval={this.onChangeRefreshInterval}\n                splitted={splitted}\n                loading={loading || (isLive && !isPaused)}\n                onRun={this.onRunQuery}\n                showDropdown={!isLive}\n              />\n              {refreshInterval && <SetInterval func={this.onRunQuery} interval={refreshInterval} loading={loading} />}\n            </div>\n\n            {hasLiveOption && (\n              <div className={`explore-toolbar-content-item ${styles.liveTailButtons}`}>\n                <LiveTailControls exploreId={exploreId}>\n                  {controls => (\n                    <LiveTailButton\n                      splitted={splitted}\n                      isLive={isLive}\n                      isPaused={isPaused}\n                      start={controls.start}\n                      pause={controls.pause}\n                      resume={controls.resume}\n                      stop={controls.stop}\n                    />\n                  )}\n                </LiveTailControls>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state: StoreState, { exploreId }: OwnProps): StateProps => {\n  const splitted = state.explore.split;\n  const syncedTimes = state.explore.syncedTimes;\n  const exploreItem: ExploreItemState = state.explore[exploreId];\n  const {\n    datasourceInstance,\n    datasourceMissing,\n    range,\n    refreshInterval,\n    loading,\n    supportedModes,\n    mode,\n    isLive,\n    isPaused,\n    originPanelId,\n    queries,\n    datasourceLoading,\n    containerWidth,\n  } = exploreItem;\n\n  const hasLiveOption = datasourceInstance?.meta?.streaming && mode === ExploreMode.Logs;\n\n  return {\n    datasourceMissing,\n    datasourceName: datasourceInstance?.name,\n    loading,\n    range,\n    timeZone: getTimeZone(state.user),\n    splitted,\n    refreshInterval,\n    supportedModes,\n    selectedMode: supportedModes.includes(mode) ? mode : supportedModes[0],\n    hasLiveOption,\n    isLive,\n    isPaused,\n    originPanelId,\n    queries,\n    syncedTimes,\n    datasourceLoading,\n    containerWidth,\n  };\n};\n\nconst mapDispatchToProps: DispatchProps = {\n  changeDatasource,\n  updateLocation,\n  changeRefreshInterval,\n  clearAll: clearQueries,\n  runQueries,\n  closeSplit: splitClose,\n  split: splitOpen,\n  syncTimes,\n  changeMode: changeMode,\n  setDashboardQueriesToUpdateOnLoad,\n};\n\nexport const ExploreToolbar = hot(module)(connect(mapStateToProps, mapDispatchToProps)(UnConnectedExploreToolbar));\n","import React, { PureComponent } from 'react';\nimport { css, cx } from 'emotion';\nimport tinycolor from 'tinycolor2';\n\nimport { Themeable, withTheme, getLogRowStyles } from '@grafana/ui';\nimport { GrafanaTheme, LogRowModel, TimeZone } from '@grafana/data';\n\nimport ElapsedTime from './ElapsedTime';\n\nconst getStyles = (theme: GrafanaTheme) => ({\n  logsRowsLive: css`\n    label: logs-rows-live;\n    font-family: ${theme.typography.fontFamily.monospace};\n    font-size: ${theme.typography.size.sm};\n    display: flex;\n    flex-flow: column nowrap;\n    height: 65vh;\n    overflow-y: auto;\n    :first-child {\n      margin-top: auto !important;\n    }\n  `,\n  logsRowFade: css`\n    label: logs-row-fresh;\n    color: ${theme.colors.text};\n    background-color: ${tinycolor(theme.colors.blueLight)\n      .setAlpha(0.25)\n      .toString()};\n    animation: fade 1s ease-out 1s 1 normal forwards;\n    @keyframes fade {\n      from {\n        background-color: ${tinycolor(theme.colors.blueLight)\n          .setAlpha(0.25)\n          .toString()};\n      }\n      to {\n        background-color: transparent;\n      }\n    }\n  `,\n  logsRowsIndicator: css`\n    font-size: ${theme.typography.size.md};\n    padding-top: ${theme.spacing.sm};\n    display: flex;\n    align-items: center;\n  `,\n  button: css`\n    margin-right: ${theme.spacing.sm};\n  `,\n  fullWidth: css`\n    width: 100%;\n  `,\n});\n\nexport interface Props extends Themeable {\n  logRows?: LogRowModel[];\n  timeZone: TimeZone;\n  stopLive: () => void;\n  onPause: () => void;\n  onResume: () => void;\n  isPaused: boolean;\n}\n\ninterface State {\n  logRowsToRender?: LogRowModel[];\n}\n\nclass LiveLogs extends PureComponent<Props, State> {\n  private liveEndDiv: HTMLDivElement | null = null;\n  private scrollContainerRef = React.createRef<HTMLTableSectionElement>();\n  private lastScrollPos: number | null = null;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      logRowsToRender: props.logRows,\n    };\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (!prevProps.isPaused && this.props.isPaused) {\n      // So we paused the view and we changed the content size, but we want to keep the relative offset from the bottom.\n      if (this.lastScrollPos && this.scrollContainerRef.current) {\n        // There is last scroll pos from when user scrolled up a bit so go to that position.\n        const { clientHeight, scrollHeight } = this.scrollContainerRef.current;\n        const scrollTop = scrollHeight - (this.lastScrollPos + clientHeight);\n        this.scrollContainerRef.current.scrollTo(0, scrollTop);\n        this.lastScrollPos = null;\n      } else {\n        // We do not have any position to jump to su the assumption is user just clicked pause. We can just scroll\n        // to the bottom.\n        if (this.liveEndDiv) {\n          this.liveEndDiv.scrollIntoView(false);\n        }\n      }\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps: Props, state: State) {\n    if (!nextProps.isPaused) {\n      return {\n        // We update what we show only if not paused. We keep any background subscriptions running and keep updating\n        // our state, but we do not show the updates, this allows us start again showing correct result after resuming\n        // without creating a gap in the log results.\n        logRowsToRender: nextProps.logRows,\n      };\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Handle pausing when user scrolls up so that we stop resetting his position to the bottom when new row arrives.\n   * We do not need to throttle it here much, adding new rows should be throttled/buffered itself in the query epics\n   * and after you pause we remove the handler and add it after you manually resume, so this should not be fired often.\n   */\n  onScroll = (event: React.SyntheticEvent) => {\n    const { isPaused, onPause } = this.props;\n    const { scrollTop, clientHeight, scrollHeight } = event.currentTarget;\n    const distanceFromBottom = scrollHeight - (scrollTop + clientHeight);\n    if (distanceFromBottom >= 5 && !isPaused) {\n      onPause();\n      this.lastScrollPos = distanceFromBottom;\n    }\n  };\n\n  rowsToRender = () => {\n    const { isPaused } = this.props;\n    let { logRowsToRender: rowsToRender = [] } = this.state;\n    if (!isPaused) {\n      // A perf optimisation here. Show just 100 rows when streaming and full length when the streaming is paused.\n      rowsToRender = rowsToRender.slice(-100);\n    }\n    return rowsToRender;\n  };\n\n  render() {\n    const { theme, timeZone, onPause, onResume, isPaused } = this.props;\n    const styles = getStyles(theme);\n    const showUtc = timeZone === 'utc';\n    const { logsRow, logsRowLocalTime, logsRowMessage } = getLogRowStyles(theme);\n\n    return (\n      <div>\n        <table className={styles.fullWidth}>\n          <tbody\n            onScroll={isPaused ? undefined : this.onScroll}\n            className={cx(['logs-rows', styles.logsRowsLive])}\n            ref={this.scrollContainerRef}\n          >\n            {this.rowsToRender().map((row: LogRowModel) => {\n              return (\n                <tr className={cx(logsRow, styles.logsRowFade)} key={row.uid}>\n                  {showUtc && (\n                    <td className={cx(logsRowLocalTime)} title={`Local: ${row.timeLocal} (${row.timeFromNow})`}>\n                      {row.timeUtc}\n                    </td>\n                  )}\n                  {!showUtc && (\n                    <td className={cx(logsRowLocalTime)} title={`${row.timeUtc} (${row.timeFromNow})`}>\n                      {row.timeLocal}\n                    </td>\n                  )}\n                  <td className={cx(logsRowMessage)}>{row.entry}</td>\n                </tr>\n              );\n            })}\n            <tr\n              ref={element => {\n                this.liveEndDiv = element;\n                // This is triggered on every update so on every new row. It keeps the view scrolled at the bottom by\n                // default.\n                if (this.liveEndDiv && !isPaused) {\n                  this.liveEndDiv.scrollIntoView(false);\n                }\n              }}\n            />\n          </tbody>\n        </table>\n        <div className={cx([styles.logsRowsIndicator])}>\n          <button onClick={isPaused ? onResume : onPause} className={cx('btn btn-secondary', styles.button)}>\n            <i className={cx('fa', isPaused ? 'fa-play' : 'fa-pause')} />\n            &nbsp;\n            {isPaused ? 'Resume' : 'Pause'}\n          </button>\n          <button onClick={this.props.stopLive} className={cx('btn btn-inverse', styles.button)}>\n            <i className={'fa fa-stop'} />\n            &nbsp; Exit live mode\n          </button>\n          {isPaused || (\n            <span>\n              Last line received: <ElapsedTime resetKey={this.props.logRows} humanize={true} /> ago\n            </span>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport const LiveLogsWithTheme = withTheme(LiveLogs);\n","import React from 'react';\nimport classNames from 'classnames';\nimport tinycolor from 'tinycolor2';\nimport { css } from 'emotion';\nimport { CSSTransition } from 'react-transition-group';\nimport { useTheme, Tooltip, stylesFactory, selectThemeVariant } from '@grafana/ui';\nimport { GrafanaTheme } from '@grafana/data';\n\n//Components\nimport { ResponsiveButton } from './ResponsiveButton';\n\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\n  const bgColor = selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.dark1 }, theme.type);\n  const orangeLighter = tinycolor(theme.colors.orangeDark)\n    .lighten(10)\n    .toString();\n  const pulseTextColor = tinycolor(theme.colors.orangeDark)\n    .desaturate(90)\n    .toString();\n  return {\n    noRightBorderStyle: css`\n      label: noRightBorderStyle;\n      border-right: 0;\n    `,\n    liveButton: css`\n      label: liveButton;\n      margin: 0;\n    `,\n    isLive: css`\n      label: isLive;\n      border-color: ${theme.colors.orangeDark};\n      color: ${theme.colors.orangeDark};\n      background: transparent;\n      &:focus {\n        background: transparent;\n        border-color: ${theme.colors.orangeDark};\n        color: ${theme.colors.orangeDark};\n      }\n      &:hover {\n        background-color: ${bgColor};\n      }\n      &:active,\n      &:hover {\n        border-color: ${orangeLighter};\n        color: ${orangeLighter};\n      }\n    `,\n    isPaused: css`\n      label: isPaused;\n      border-color: ${theme.colors.orangeDark};\n      background: transparent;\n      animation: pulse 3s ease-out 0s infinite normal forwards;\n      &:focus {\n        background: transparent;\n        border-color: ${theme.colors.orangeDark};\n      }\n      &:hover {\n        background-color: ${bgColor};\n      }\n      &:active,\n      &:hover {\n        border-color: ${orangeLighter};\n      }\n      @keyframes pulse {\n        0% {\n          color: ${pulseTextColor};\n        }\n        50% {\n          color: ${theme.colors.orangeDark};\n        }\n        100% {\n          color: ${pulseTextColor};\n        }\n      }\n    `,\n    stopButtonEnter: css`\n      label: stopButtonEnter;\n      width: 0;\n      opacity: 0;\n      overflow: hidden;\n    `,\n    stopButtonEnterActive: css`\n      label: stopButtonEnterActive;\n      opacity: 1;\n      width: 32px;\n    `,\n    stopButtonExit: css`\n      label: stopButtonExit;\n      width: 32px;\n      opacity: 1;\n      overflow: hidden;\n    `,\n    stopButtonExitActive: css`\n      label: stopButtonExitActive;\n      opacity: 0;\n      width: 0;\n    `,\n  };\n});\n\nconst defaultLiveTooltip = () => {\n  return <>Live</>;\n};\n\ntype LiveTailButtonProps = {\n  splitted: boolean;\n  start: () => void;\n  stop: () => void;\n  pause: () => void;\n  resume: () => void;\n  isLive: boolean;\n  isPaused: boolean;\n};\nexport function LiveTailButton(props: LiveTailButtonProps) {\n  const { start, pause, resume, isLive, isPaused, stop, splitted } = props;\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  const onClickMain = isLive ? (isPaused ? resume : pause) : start;\n\n  return (\n    <>\n      <Tooltip content={defaultLiveTooltip} placement=\"bottom\">\n        <ResponsiveButton\n          splitted={splitted}\n          buttonClassName={classNames('btn navbar-button', styles.liveButton, {\n            [`btn--radius-right-0 explore-active-button-glow ${styles.noRightBorderStyle}`]: isLive,\n            [styles.isLive]: isLive && !isPaused,\n            [styles.isPaused]: isLive && isPaused,\n          })}\n          iconClassName={classNames(\n            'fa',\n            isPaused || !isLive ? 'fa-play' : 'fa-pause',\n            isLive && 'icon-brand-gradient'\n          )}\n          onClick={onClickMain}\n          title={'\\xa0Live'}\n        />\n      </Tooltip>\n      <CSSTransition\n        mountOnEnter={true}\n        unmountOnExit={true}\n        timeout={500}\n        in={isLive}\n        classNames={{\n          enter: styles.stopButtonEnter,\n          enterActive: styles.stopButtonEnterActive,\n          exit: styles.stopButtonExit,\n          exitActive: styles.stopButtonExitActive,\n        }}\n      >\n        <div>\n          <button\n            className={`btn navbar-button navbar-button--attached explore-active-button-glow ${styles.isLive}`}\n            onClick={stop}\n          >\n            <i className={classNames('fa fa-stop icon-brand-gradient')} />\n          </button>\n        </div>\n      </CSSTransition>\n    </>\n  );\n}\n","import React, { PureComponent } from 'react';\n\nimport {\n  rangeUtil,\n  RawTimeRange,\n  LogLevel,\n  TimeZone,\n  AbsoluteTimeRange,\n  LogsMetaKind,\n  LogsDedupStrategy,\n  LogRowModel,\n  LogsDedupDescription,\n  LogsMetaItem,\n  GraphSeriesXY,\n  LinkModel,\n  Field,\n} from '@grafana/data';\nimport { Switch, LogLabels, ToggleButtonGroup, ToggleButton, LogRows } from '@grafana/ui';\nimport store from 'app/core/store';\n\nimport { ExploreGraphPanel } from './ExploreGraphPanel';\n\nconst SETTINGS_KEYS = {\n  showLabels: 'grafana.explore.logs.showLabels',\n  showTime: 'grafana.explore.logs.showTime',\n  wrapLogMessage: 'grafana.explore.logs.wrapLogMessage',\n};\n\nfunction renderMetaItem(value: any, kind: LogsMetaKind) {\n  if (kind === LogsMetaKind.LabelsMap) {\n    return (\n      <span className=\"logs-meta-item__labels\">\n        <LogLabels labels={value} />\n      </span>\n    );\n  }\n  return value;\n}\n\ninterface Props {\n  logRows?: LogRowModel[];\n  logsMeta?: LogsMetaItem[];\n  logsSeries?: GraphSeriesXY[];\n  dedupedRows?: LogRowModel[];\n\n  width: number;\n  highlighterExpressions?: string[];\n  loading: boolean;\n  absoluteRange: AbsoluteTimeRange;\n  timeZone: TimeZone;\n  scanning?: boolean;\n  scanRange?: RawTimeRange;\n  dedupStrategy: LogsDedupStrategy;\n  onChangeTime: (range: AbsoluteTimeRange) => void;\n  onClickFilterLabel?: (key: string, value: string) => void;\n  onClickFilterOutLabel?: (key: string, value: string) => void;\n  onStartScanning?: () => void;\n  onStopScanning?: () => void;\n  onDedupStrategyChange: (dedupStrategy: LogsDedupStrategy) => void;\n  onToggleLogLevel: (hiddenLogLevels: LogLevel[]) => void;\n  getRowContext?: (row: LogRowModel, options?: any) => Promise<any>;\n  getFieldLinks: (field: Field, rowIndex: number) => Array<LinkModel<Field>>;\n}\n\ninterface State {\n  showLabels: boolean;\n  showTime: boolean;\n  wrapLogMessage: boolean;\n}\n\nexport class Logs extends PureComponent<Props, State> {\n  state = {\n    showLabels: store.getBool(SETTINGS_KEYS.showLabels, false),\n    showTime: store.getBool(SETTINGS_KEYS.showTime, true),\n    wrapLogMessage: store.getBool(SETTINGS_KEYS.wrapLogMessage, true),\n  };\n\n  onChangeDedup = (dedup: LogsDedupStrategy) => {\n    const { onDedupStrategyChange } = this.props;\n    if (this.props.dedupStrategy === dedup) {\n      return onDedupStrategyChange(LogsDedupStrategy.none);\n    }\n    return onDedupStrategyChange(dedup);\n  };\n\n  onChangeLabels = (event?: React.SyntheticEvent) => {\n    const target = event && (event.target as HTMLInputElement);\n    if (target) {\n      const showLabels = target.checked;\n      this.setState({\n        showLabels,\n      });\n      store.set(SETTINGS_KEYS.showLabels, showLabels);\n    }\n  };\n\n  onChangeTime = (event?: React.SyntheticEvent) => {\n    const target = event && (event.target as HTMLInputElement);\n    if (target) {\n      const showTime = target.checked;\n      this.setState({\n        showTime,\n      });\n      store.set(SETTINGS_KEYS.showTime, showTime);\n    }\n  };\n\n  onChangewrapLogMessage = (event?: React.SyntheticEvent) => {\n    const target = event && (event.target as HTMLInputElement);\n    if (target) {\n      const wrapLogMessage = target.checked;\n      this.setState({\n        wrapLogMessage,\n      });\n      store.set(SETTINGS_KEYS.wrapLogMessage, wrapLogMessage);\n    }\n  };\n\n  onToggleLogLevel = (hiddenRawLevels: string[]) => {\n    const hiddenLogLevels: LogLevel[] = hiddenRawLevels.map(level => LogLevel[level as LogLevel]);\n    this.props.onToggleLogLevel(hiddenLogLevels);\n  };\n\n  onClickScan = (event: React.SyntheticEvent) => {\n    event.preventDefault();\n    if (this.props.onStartScanning) {\n      this.props.onStartScanning();\n    }\n  };\n\n  onClickStopScan = (event: React.SyntheticEvent) => {\n    event.preventDefault();\n    if (this.props.onStopScanning) {\n      this.props.onStopScanning();\n    }\n  };\n\n  render() {\n    const {\n      logRows,\n      logsMeta,\n      logsSeries,\n      highlighterExpressions,\n      loading = false,\n      onClickFilterLabel,\n      onClickFilterOutLabel,\n      timeZone,\n      scanning,\n      scanRange,\n      width,\n      dedupedRows,\n      absoluteRange,\n      onChangeTime,\n      getFieldLinks,\n    } = this.props;\n\n    if (!logRows) {\n      return null;\n    }\n\n    const { showLabels, showTime, wrapLogMessage } = this.state;\n    const { dedupStrategy } = this.props;\n    const hasData = logRows && logRows.length > 0;\n    const dedupCount = dedupedRows\n      ? dedupedRows.reduce((sum, row) => (row.duplicates ? sum + row.duplicates : sum), 0)\n      : 0;\n    const meta = logsMeta ? [...logsMeta] : [];\n\n    if (dedupStrategy !== LogsDedupStrategy.none) {\n      meta.push({\n        label: 'Dedup count',\n        value: dedupCount,\n        kind: LogsMetaKind.Number,\n      });\n    }\n\n    const scanText = scanRange ? `Scanning ${rangeUtil.describeTimeRange(scanRange)}` : 'Scanning...';\n    const series = logsSeries ? logsSeries : [];\n\n    return (\n      <div className=\"logs-panel\">\n        <div className=\"logs-panel-graph\">\n          <ExploreGraphPanel\n            series={series}\n            width={width}\n            onHiddenSeriesChanged={this.onToggleLogLevel}\n            loading={loading}\n            absoluteRange={absoluteRange}\n            isStacked={true}\n            showPanel={false}\n            showingGraph={true}\n            showingTable={true}\n            timeZone={timeZone}\n            showBars={true}\n            showLines={false}\n            onUpdateTimeRange={onChangeTime}\n          />\n        </div>\n        <div className=\"logs-panel-options\">\n          <div className=\"logs-panel-controls\">\n            <Switch label=\"Time\" checked={showTime} onChange={this.onChangeTime} transparent />\n            <Switch label=\"Unique labels\" checked={showLabels} onChange={this.onChangeLabels} transparent />\n            <Switch label=\"Wrap lines\" checked={wrapLogMessage} onChange={this.onChangewrapLogMessage} transparent />\n            <ToggleButtonGroup label=\"Dedup\" transparent={true}>\n              {Object.keys(LogsDedupStrategy).map((dedupType: string, i) => (\n                <ToggleButton\n                  key={i}\n                  value={dedupType}\n                  onChange={this.onChangeDedup}\n                  selected={dedupStrategy === dedupType}\n                  // @ts-ignore\n                  tooltip={LogsDedupDescription[dedupType]}\n                >\n                  {dedupType}\n                </ToggleButton>\n              ))}\n            </ToggleButtonGroup>\n          </div>\n        </div>\n\n        {hasData && meta && (\n          <div className=\"logs-panel-meta\">\n            {meta.map(item => (\n              <div className=\"logs-panel-meta__item\" key={item.label}>\n                <span className=\"logs-panel-meta__label\">{item.label}:</span>\n                <span className=\"logs-panel-meta__value\">{renderMetaItem(item.value, item.kind)}</span>\n              </div>\n            ))}\n          </div>\n        )}\n\n        <LogRows\n          logRows={logRows}\n          deduplicatedRows={dedupedRows}\n          dedupStrategy={dedupStrategy}\n          getRowContext={this.props.getRowContext}\n          highlighterExpressions={highlighterExpressions}\n          rowLimit={logRows ? logRows.length : undefined}\n          onClickFilterLabel={onClickFilterLabel}\n          onClickFilterOutLabel={onClickFilterOutLabel}\n          showLabels={showLabels}\n          showTime={showTime}\n          wrapLogMessage={wrapLogMessage}\n          timeZone={timeZone}\n          getFieldLinks={getFieldLinks}\n        />\n\n        {!loading && !hasData && !scanning && (\n          <div className=\"logs-panel-nodata\">\n            No logs found.\n            <a className=\"link\" onClick={this.onClickScan}>\n              Scan for older logs\n            </a>\n          </div>\n        )}\n\n        {scanning && (\n          <div className=\"logs-panel-nodata\">\n            <span>{scanText}</span>\n            <a className=\"link\" onClick={this.onClickStopScan}>\n              Stop scan\n            </a>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\nimport { Collapse } from '@grafana/ui';\n\nimport {\n  DataSourceApi,\n  RawTimeRange,\n  LogLevel,\n  TimeZone,\n  AbsoluteTimeRange,\n  LogRowModel,\n  LogsDedupStrategy,\n  TimeRange,\n  LogsMetaItem,\n  GraphSeriesXY,\n} from '@grafana/data';\n\nimport { ExploreId, ExploreItemState } from 'app/types/explore';\nimport { StoreState } from 'app/types';\n\nimport { changeDedupStrategy, updateTimeRange } from './state/actions';\nimport { toggleLogLevelAction } from 'app/features/explore/state/actionTypes';\nimport { deduplicatedRowsSelector } from 'app/features/explore/state/selectors';\nimport { getTimeZone } from '../profile/state/selectors';\nimport { LiveLogsWithTheme } from './LiveLogs';\nimport { Logs } from './Logs';\nimport { LogsCrossFadeTransition } from './utils/LogsCrossFadeTransition';\nimport { LiveTailControls } from './useLiveTailControls';\nimport { getLinksFromLogsField } from '../panel/panellinks/linkSuppliers';\n\ninterface LogsContainerProps {\n  datasourceInstance?: DataSourceApi;\n  exploreId: ExploreId;\n  loading: boolean;\n\n  logsHighlighterExpressions?: string[];\n  logRows?: LogRowModel[];\n  logsMeta?: LogsMetaItem[];\n  logsSeries?: GraphSeriesXY[];\n  dedupedRows?: LogRowModel[];\n\n  onClickFilterLabel?: (key: string, value: string) => void;\n  onClickFilterOutLabel?: (key: string, value: string) => void;\n  onStartScanning: () => void;\n  onStopScanning: () => void;\n  timeZone: TimeZone;\n  scanning?: boolean;\n  scanRange?: RawTimeRange;\n  toggleLogLevelAction: typeof toggleLogLevelAction;\n  changeDedupStrategy: typeof changeDedupStrategy;\n  dedupStrategy: LogsDedupStrategy;\n  width: number;\n  isLive: boolean;\n  updateTimeRange: typeof updateTimeRange;\n  range: TimeRange;\n  syncedTimes: boolean;\n  absoluteRange: AbsoluteTimeRange;\n  isPaused: boolean;\n}\n\nexport class LogsContainer extends PureComponent<LogsContainerProps> {\n  onChangeTime = (absoluteRange: AbsoluteTimeRange) => {\n    const { exploreId, updateTimeRange } = this.props;\n    updateTimeRange({ exploreId, absoluteRange });\n  };\n\n  handleDedupStrategyChange = (dedupStrategy: LogsDedupStrategy) => {\n    this.props.changeDedupStrategy(this.props.exploreId, dedupStrategy);\n  };\n\n  handleToggleLogLevel = (hiddenLogLevels: LogLevel[]) => {\n    const { exploreId } = this.props;\n    this.props.toggleLogLevelAction({\n      exploreId,\n      hiddenLogLevels,\n    });\n  };\n\n  getLogRowContext = async (row: LogRowModel, options?: any): Promise<any> => {\n    const { datasourceInstance } = this.props;\n\n    if (datasourceInstance?.getLogRowContext) {\n      return datasourceInstance.getLogRowContext(row, options);\n    }\n\n    return [];\n  };\n\n  render() {\n    const {\n      loading,\n      logsHighlighterExpressions,\n      logRows,\n      logsMeta,\n      logsSeries,\n      dedupedRows,\n      onClickFilterLabel,\n      onClickFilterOutLabel,\n      onStartScanning,\n      onStopScanning,\n      absoluteRange,\n      timeZone,\n      scanning,\n      range,\n      width,\n      isLive,\n      exploreId,\n    } = this.props;\n\n    return (\n      <>\n        <LogsCrossFadeTransition visible={isLive}>\n          <Collapse label=\"Logs\" loading={false} isOpen>\n            <LiveTailControls exploreId={exploreId}>\n              {controls => (\n                <LiveLogsWithTheme\n                  logRows={logRows}\n                  timeZone={timeZone}\n                  stopLive={controls.stop}\n                  isPaused={this.props.isPaused}\n                  onPause={controls.pause}\n                  onResume={controls.resume}\n                />\n              )}\n            </LiveTailControls>\n          </Collapse>\n        </LogsCrossFadeTransition>\n        <LogsCrossFadeTransition visible={!isLive}>\n          <Collapse label=\"Logs\" loading={loading} isOpen>\n            <Logs\n              dedupStrategy={this.props.dedupStrategy || LogsDedupStrategy.none}\n              logRows={logRows}\n              logsMeta={logsMeta}\n              logsSeries={logsSeries}\n              dedupedRows={dedupedRows}\n              highlighterExpressions={logsHighlighterExpressions}\n              loading={loading}\n              onChangeTime={this.onChangeTime}\n              onClickFilterLabel={onClickFilterLabel}\n              onClickFilterOutLabel={onClickFilterOutLabel}\n              onStartScanning={onStartScanning}\n              onStopScanning={onStopScanning}\n              onDedupStrategyChange={this.handleDedupStrategyChange}\n              onToggleLogLevel={this.handleToggleLogLevel}\n              absoluteRange={absoluteRange}\n              timeZone={timeZone}\n              scanning={scanning}\n              scanRange={range.raw}\n              width={width}\n              getRowContext={this.getLogRowContext}\n              getFieldLinks={getLinksFromLogsField}\n            />\n          </Collapse>\n        </LogsCrossFadeTransition>\n      </>\n    );\n  }\n}\n\nfunction mapStateToProps(state: StoreState, { exploreId }: { exploreId: string }) {\n  const explore = state.explore;\n  // @ts-ignore\n  const item: ExploreItemState = explore[exploreId];\n  const {\n    logsHighlighterExpressions,\n    logsResult,\n    loading,\n    scanning,\n    datasourceInstance,\n    isLive,\n    isPaused,\n    range,\n    absoluteRange,\n    dedupStrategy,\n  } = item;\n  const dedupedRows = deduplicatedRowsSelector(item);\n  const timeZone = getTimeZone(state.user);\n\n  return {\n    loading,\n    logsHighlighterExpressions,\n    logRows: logsResult && logsResult.rows,\n    logsMeta: logsResult && logsResult.meta,\n    logsSeries: logsResult && logsResult.series,\n    scanning,\n    timeZone,\n    dedupStrategy,\n    dedupedRows,\n    datasourceInstance,\n    isLive,\n    isPaused,\n    range,\n    absoluteRange,\n  };\n}\n\nconst mapDispatchToProps = {\n  changeDedupStrategy,\n  toggleLogLevelAction,\n  updateTimeRange,\n};\n\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(LogsContainer));\n","import React, { useContext } from 'react';\nimport { css } from 'emotion';\nimport { ThemeContext, LinkButton, CallToActionCard } from '@grafana/ui';\n\nexport const NoDataSourceCallToAction = () => {\n  const theme = useContext(ThemeContext);\n\n  const message =\n    'Explore requires at least one data source. Once you have added a data source, you can query it here.';\n  const footer = (\n    <>\n      <i className=\"fa fa-rocket\" />\n      <> ProTip: You can also define data sources through configuration files. </>\n      <a\n        href=\"http://docs.grafana.org/administration/provisioning/#datasources?utm_source=explore\"\n        target=\"_blank\"\n        rel=\"noopener\"\n        className=\"text-link\"\n      >\n        Learn more\n      </a>\n    </>\n  );\n\n  const ctaElement = (\n    <LinkButton size=\"lg\" href=\"/datasources/new\" icon=\"gicon gicon-datasources\">\n      Add data source\n    </LinkButton>\n  );\n\n  const cardClassName = css`\n    max-width: ${theme.breakpoints.lg};\n    margin-top: ${theme.spacing.md};\n    align-self: center;\n  `;\n\n  return (\n    <CallToActionCard\n      callToActionElement={ctaElement}\n      className={cardClassName}\n      footer={footer}\n      message={message}\n      theme={theme}\n    />\n  );\n};\n","// Libraries\nimport React, { PureComponent } from 'react';\n\n// Services\nimport { getAngularLoader, AngularComponent } from '@grafana/runtime';\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\n\n// Types\nimport { Emitter } from 'app/core/utils/emitter';\nimport { DataQuery } from '@grafana/data';\nimport { TimeRange } from '@grafana/data';\nimport 'app/features/plugins/plugin_loader';\nimport { dateTime } from '@grafana/data';\n\ninterface QueryEditorProps {\n  error?: any;\n  datasource: any;\n  onExecuteQuery?: () => void;\n  onQueryChange?: (value: DataQuery) => void;\n  initialQuery: DataQuery;\n  exploreEvents: Emitter;\n  range: TimeRange;\n  textEditModeEnabled?: boolean;\n}\n\nexport default class QueryEditor extends PureComponent<QueryEditorProps, any> {\n  element: any;\n  component: AngularComponent;\n  angularScope: any;\n\n  async componentDidMount() {\n    if (!this.element) {\n      return;\n    }\n\n    const { datasource, initialQuery, exploreEvents, range } = this.props;\n    this.initTimeSrv(range);\n\n    const loader = getAngularLoader();\n    const template = '<plugin-component type=\"query-ctrl\"> </plugin-component>';\n    const target = { datasource: datasource.name, ...initialQuery };\n    const scopeProps = {\n      ctrl: {\n        datasource,\n        target,\n        refresh: () => {\n          setTimeout(() => {\n            this.props.onQueryChange?.(target);\n            this.props.onExecuteQuery?.();\n          }, 1);\n        },\n        onQueryChange: () => {\n          setTimeout(() => {\n            this.props.onQueryChange?.(target);\n          }, 1);\n        },\n        events: exploreEvents,\n        panel: { datasource, targets: [target] },\n        dashboard: {},\n      },\n    };\n\n    this.component = loader.load(this.element, scopeProps, template);\n    this.angularScope = scopeProps.ctrl;\n\n    setTimeout(() => {\n      this.props.onQueryChange?.(target);\n      this.props.onExecuteQuery?.();\n    }, 1);\n  }\n\n  componentDidUpdate(prevProps: QueryEditorProps) {\n    const hasToggledEditorMode = prevProps.textEditModeEnabled !== this.props.textEditModeEnabled;\n    const hasNewError = prevProps.error !== this.props.error;\n\n    if (this.component) {\n      if (hasToggledEditorMode && this.angularScope && this.angularScope.toggleEditorMode) {\n        this.angularScope.toggleEditorMode();\n      }\n\n      if (hasNewError || hasToggledEditorMode) {\n        // Some query controllers listen to data error events and need a digest\n        // for some reason this needs to be done in next tick\n        setTimeout(this.component.digest);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.component) {\n      this.component.destroy();\n    }\n  }\n\n  initTimeSrv(range: TimeRange) {\n    const timeSrv = getTimeSrv();\n    timeSrv.init({\n      time: {\n        from: dateTime(range.from),\n        to: dateTime(range.to),\n      },\n      refresh: false,\n      getTimezone: () => 'utc',\n      timeRangeUpdated: () => console.log('refreshDashboard!'),\n    });\n  }\n\n  render() {\n    return <div className=\"gf-form-query\" ref={element => (this.element = element)} style={{ width: '100%' }} />;\n  }\n}\n","// Libraries\nimport React, { PureComponent } from 'react';\nimport debounce from 'lodash/debounce';\nimport has from 'lodash/has';\nimport { hot } from 'react-hot-loader';\n// @ts-ignore\nimport { connect } from 'react-redux';\n// Components\nimport QueryEditor from './QueryEditor';\nimport { QueryRowActions } from './QueryRowActions';\n// Actions\nimport { changeQuery, modifyQueries, runQueries } from './state/actions';\n// Types\nimport { StoreState } from 'app/types';\nimport {\n  DataQuery,\n  DataSourceApi,\n  PanelData,\n  HistoryItem,\n  TimeRange,\n  AbsoluteTimeRange,\n  LoadingState,\n} from '@grafana/data';\n\nimport { ExploreItemState, ExploreId, ExploreMode } from 'app/types/explore';\nimport { Emitter } from 'app/core/utils/emitter';\nimport { highlightLogsExpressionAction, removeQueryRowAction } from './state/actionTypes';\n\ninterface PropsFromParent {\n  exploreId: ExploreId;\n  index: number;\n  exploreEvents: Emitter;\n}\n\ninterface QueryRowProps extends PropsFromParent {\n  changeQuery: typeof changeQuery;\n  className?: string;\n  exploreId: ExploreId;\n  datasourceInstance: DataSourceApi;\n  highlightLogsExpressionAction: typeof highlightLogsExpressionAction;\n  history: HistoryItem[];\n  query: DataQuery;\n  modifyQueries: typeof modifyQueries;\n  range: TimeRange;\n  absoluteRange: AbsoluteTimeRange;\n  removeQueryRowAction: typeof removeQueryRowAction;\n  runQueries: typeof runQueries;\n  queryResponse: PanelData;\n  mode: ExploreMode;\n  latency: number;\n}\n\ninterface QueryRowState {\n  textEditModeEnabled: boolean;\n}\n\n// Empty function to override blur execution on query field\nconst noopOnBlur = () => {};\n\nexport class QueryRow extends PureComponent<QueryRowProps, QueryRowState> {\n  state: QueryRowState = {\n    textEditModeEnabled: false,\n  };\n\n  onRunQuery = () => {\n    const { exploreId } = this.props;\n    this.props.runQueries(exploreId);\n  };\n\n  onChange = (query: DataQuery, override?: boolean) => {\n    const { datasourceInstance, exploreId, index } = this.props;\n    this.props.changeQuery(exploreId, query, index, override);\n    if (query && !override && datasourceInstance.getHighlighterExpression && index === 0) {\n      // Live preview of log search matches. Only use on first row for now\n      this.updateLogsHighlights(query);\n    }\n  };\n\n  componentWillUnmount() {\n    console.log('QueryRow will unmount');\n  }\n\n  onClickToggleDisabled = () => {\n    const { exploreId, index, query } = this.props;\n    const newQuery = {\n      ...query,\n      hide: !query.hide,\n    };\n    this.props.changeQuery(exploreId, newQuery, index, true);\n  };\n\n  onClickRemoveButton = () => {\n    const { exploreId, index } = this.props;\n    this.props.removeQueryRowAction({ exploreId, index });\n    this.props.runQueries(exploreId);\n  };\n\n  onClickToggleEditorMode = () => {\n    this.setState({ textEditModeEnabled: !this.state.textEditModeEnabled });\n  };\n\n  updateLogsHighlights = debounce((value: DataQuery) => {\n    const { datasourceInstance } = this.props;\n    if (datasourceInstance.getHighlighterExpression) {\n      const { exploreId } = this.props;\n      const expressions = datasourceInstance.getHighlighterExpression(value);\n      this.props.highlightLogsExpressionAction({ exploreId, expressions });\n    }\n  }, 500);\n\n  render() {\n    const {\n      datasourceInstance,\n      history,\n      query,\n      exploreEvents,\n      range,\n      absoluteRange,\n      queryResponse,\n      mode,\n      latency,\n    } = this.props;\n\n    const canToggleEditorModes =\n      mode === ExploreMode.Metrics && has(datasourceInstance, 'components.QueryCtrl.prototype.toggleEditorMode');\n    const isNotStarted = queryResponse.state === LoadingState.NotStarted;\n    const queryErrors = queryResponse.error && queryResponse.error.refId === query.refId ? [queryResponse.error] : [];\n    let QueryField;\n\n    if (mode === ExploreMode.Metrics && datasourceInstance.components?.ExploreMetricsQueryField) {\n      QueryField = datasourceInstance.components.ExploreMetricsQueryField;\n    } else if (mode === ExploreMode.Logs && datasourceInstance.components?.ExploreLogsQueryField) {\n      QueryField = datasourceInstance.components.ExploreLogsQueryField;\n    } else {\n      QueryField = datasourceInstance.components?.ExploreQueryField;\n    }\n\n    return (\n      <div className=\"query-row\">\n        <div className=\"query-row-field flex-shrink-1\">\n          {QueryField ? (\n            <QueryField\n              datasource={datasourceInstance}\n              query={query}\n              history={history}\n              onRunQuery={this.onRunQuery}\n              onBlur={noopOnBlur}\n              onChange={this.onChange}\n              data={queryResponse}\n              absoluteRange={absoluteRange}\n            />\n          ) : (\n            <QueryEditor\n              error={queryErrors}\n              datasource={datasourceInstance}\n              onQueryChange={this.onChange}\n              onExecuteQuery={this.onRunQuery}\n              initialQuery={query}\n              exploreEvents={exploreEvents}\n              range={range}\n              textEditModeEnabled={this.state.textEditModeEnabled}\n            />\n          )}\n        </div>\n        <QueryRowActions\n          canToggleEditorModes={canToggleEditorModes}\n          isDisabled={query.hide}\n          isNotStarted={isNotStarted}\n          latency={latency}\n          onClickToggleEditorMode={this.onClickToggleEditorMode}\n          onClickToggleDisabled={this.onClickToggleDisabled}\n          onClickRemoveButton={this.onClickRemoveButton}\n        />\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps(state: StoreState, { exploreId, index }: QueryRowProps) {\n  const explore = state.explore;\n  const item: ExploreItemState = explore[exploreId];\n  const { datasourceInstance, history, queries, range, absoluteRange, mode, queryResponse, latency } = item;\n  const query = queries[index];\n\n  return {\n    datasourceInstance,\n    history,\n    query,\n    range,\n    absoluteRange,\n    queryResponse,\n    mode,\n    latency,\n  };\n}\n\nconst mapDispatchToProps = {\n  changeQuery,\n  highlightLogsExpressionAction,\n  modifyQueries,\n  removeQueryRowAction,\n  runQueries,\n};\n\nexport default hot(module)(\n  connect(mapStateToProps, mapDispatchToProps)(QueryRow) as React.ComponentType<PropsFromParent>\n);\n","import React from 'react';\n\nfunction formatLatency(value: number) {\n  return `${(value / 1000).toFixed(1)}s`;\n}\n\nexport type Props = {\n  canToggleEditorModes: boolean;\n  isDisabled?: boolean;\n  isNotStarted: boolean;\n  latency: number;\n  onClickToggleEditorMode: () => void;\n  onClickToggleDisabled: () => void;\n  onClickRemoveButton: () => void;\n};\n\nexport function QueryRowActions(props: Props) {\n  const {\n    canToggleEditorModes,\n    onClickToggleEditorMode,\n    onClickToggleDisabled,\n    onClickRemoveButton,\n    isDisabled,\n    isNotStarted,\n    latency,\n  } = props;\n\n  return (\n    <div className=\"gf-form-inline flex-shrink-0\">\n      {canToggleEditorModes && (\n        <div className=\"gf-form\">\n          <button\n            aria-label=\"Edit mode button\"\n            className=\"gf-form-label gf-form-label--btn\"\n            onClick={onClickToggleEditorMode}\n          >\n            <i className=\"fa fa-pencil\" />\n          </button>\n        </div>\n      )}\n      <div className=\"gf-form\">\n        <button disabled className=\"gf-form-label\" title=\"Query row latency\">\n          {formatLatency(latency)}\n        </button>\n      </div>\n      <div className=\"gf-form\">\n        <button\n          disabled={isNotStarted}\n          className=\"gf-form-label gf-form-label--btn\"\n          onClick={onClickToggleDisabled}\n          title=\"Disable/enable query\"\n        >\n          <i className={isDisabled ? 'fa fa-eye-slash' : 'fa fa-eye'} />\n        </button>\n      </div>\n      <div className=\"gf-form\">\n        <button className=\"gf-form-label gf-form-label--btn\" onClick={onClickRemoveButton} title=\"Remove query\">\n          <i className=\"fa fa-minus\" />\n        </button>\n      </div>\n    </div>\n  );\n}\n","// Libraries\nimport React, { PureComponent } from 'react';\n\n// Components\nimport QueryRow from './QueryRow';\n\n// Types\nimport { Emitter } from 'app/core/utils/emitter';\nimport { ExploreId } from 'app/types/explore';\n\ninterface QueryRowsProps {\n  className?: string;\n  exploreEvents: Emitter;\n  exploreId: ExploreId;\n  queryKeys: string[];\n}\n\nexport default class QueryRows extends PureComponent<QueryRowsProps> {\n  render() {\n    const { className = '', exploreEvents, exploreId, queryKeys } = this.props;\n    return (\n      <div className={className}>\n        {queryKeys.map((key, index) => {\n          return <QueryRow key={key} exploreEvents={exploreEvents} exploreId={exploreId} index={index} />;\n        })}\n      </div>\n    );\n  }\n}\n","import React, { forwardRef } from 'react';\n\nexport enum IconSide {\n  left = 'left',\n  right = 'right',\n}\n\ninterface Props extends React.HTMLAttributes<HTMLDivElement> {\n  splitted: boolean;\n  title: string;\n  onClick: () => void;\n  buttonClassName?: string;\n  iconClassName?: string;\n  iconSide?: IconSide;\n  disabled?: boolean;\n}\n\nfunction formatBtnTitle(title: string, iconSide?: string): string {\n  return iconSide === IconSide.left ? '\\xA0' + title : iconSide === IconSide.right ? title + '\\xA0' : title;\n}\n\nexport const ResponsiveButton = forwardRef<HTMLDivElement, Props>((props, ref) => {\n  const defaultProps = {\n    iconSide: IconSide.left,\n  };\n\n  props = { ...defaultProps, ...props };\n  const { title, onClick, buttonClassName, iconClassName, splitted, iconSide, disabled, ...divElementProps } = props;\n\n  return (\n    <div ref={ref} {...divElementProps}>\n      <button\n        className={`btn navbar-button ${buttonClassName ? buttonClassName : ''}`}\n        onClick={onClick}\n        disabled={disabled || false}\n      >\n        {iconClassName && iconSide === IconSide.left ? <i className={`${iconClassName}`} /> : null}\n        <span className=\"btn-title\">{!splitted ? formatBtnTitle(title, iconSide) : ''}</span>\n        {iconClassName && iconSide === IconSide.right ? <i className={`${iconClassName}`} /> : null}\n      </button>\n    </div>\n  );\n});\n","import React from 'react';\nimport { RefreshPicker } from '@grafana/ui';\nimport memoizeOne from 'memoize-one';\nimport { css } from 'emotion';\nimport classNames from 'classnames';\n\nimport { ResponsiveButton } from './ResponsiveButton';\n\nconst getStyles = memoizeOne(() => {\n  return {\n    selectButtonOverride: css`\n      label: selectButtonOverride;\n      .select-button-value {\n        color: white !important;\n      }\n    `,\n  };\n});\n\ntype Props = {\n  splitted: boolean;\n  loading: boolean;\n  onRun: () => void;\n  refreshInterval?: string;\n  onChangeRefreshInterval: (interval: string) => void;\n  showDropdown: boolean;\n};\n\nexport function RunButton(props: Props) {\n  const { splitted, loading, onRun, onChangeRefreshInterval, refreshInterval, showDropdown } = props;\n  const styles = getStyles();\n  const runButton = (\n    <ResponsiveButton\n      splitted={splitted}\n      title=\"Run Query\"\n      onClick={onRun}\n      buttonClassName={classNames('navbar-button--secondary', { 'btn--radius-right-0': showDropdown })}\n      iconClassName={loading ? 'fa fa-spinner fa-fw fa-spin run-icon' : 'fa fa-refresh fa-fw'}\n    />\n  );\n\n  if (showDropdown) {\n    return (\n      <RefreshPicker\n        onIntervalChanged={onChangeRefreshInterval}\n        value={refreshInterval}\n        buttonSelectClassName={`navbar-button--secondary ${styles.selectButtonOverride}`}\n        refreshButton={runButton}\n      />\n    );\n  }\n  return runButton;\n}\n","import React, { PureComponent } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\nimport { DataFrame } from '@grafana/data';\nimport { Table, Collapse } from '@grafana/ui';\nimport { ExploreId, ExploreItemState } from 'app/types/explore';\nimport { StoreState } from 'app/types';\nimport { toggleTable } from './state/actions';\nimport { config } from 'app/core/config';\nimport { PANEL_BORDER } from 'app/core/constants';\n\ninterface TableContainerProps {\n  exploreId: ExploreId;\n  loading: boolean;\n  width: number;\n  onClickCell: (key: string, value: string) => void;\n  showingTable: boolean;\n  tableResult?: DataFrame;\n  toggleTable: typeof toggleTable;\n}\n\nexport class TableContainer extends PureComponent<TableContainerProps> {\n  onClickTableButton = () => {\n    this.props.toggleTable(this.props.exploreId, this.props.showingTable);\n  };\n\n  getTableHeight() {\n    const { tableResult } = this.props;\n\n    if (!tableResult || tableResult.length === 0) {\n      return 200;\n    }\n\n    // tries to estimate table height\n    return Math.max(Math.min(600, tableResult.length * 35) + 35);\n  }\n\n  render() {\n    const { loading, onClickCell, showingTable, tableResult, width } = this.props;\n\n    const height = this.getTableHeight();\n    const tableWidth = width - config.theme.panelPadding * 2 - PANEL_BORDER;\n\n    return (\n      <Collapse label=\"Table\" loading={loading} collapsible isOpen={showingTable} onToggle={this.onClickTableButton}>\n        {tableResult && <Table data={tableResult} width={tableWidth} height={height} onCellClick={onClickCell} />}\n      </Collapse>\n    );\n  }\n}\n\nfunction mapStateToProps(state: StoreState, { exploreId }: { exploreId: string }) {\n  const explore = state.explore;\n  // @ts-ignore\n  const item: ExploreItemState = explore[exploreId];\n  const { loading: loadingInState, showingTable, tableResult } = item;\n  const loading = tableResult && tableResult.length > 0 ? false : loadingInState;\n  return { loading, showingTable, tableResult };\n}\n\nconst mapDispatchToProps = {\n  toggleTable,\n};\n\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(TableContainer));\n","import React from 'react';\nimport classNames from 'classnames';\nimport { css } from 'emotion';\n\nimport { Tooltip, useTheme, stylesFactory } from '@grafana/ui';\nimport { GrafanaTheme } from '@grafana/data';\n\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\n  return {\n    timePickerSynced: css`\n      label: timePickerSynced;\n      border-color: ${theme.colors.orangeDark};\n      background-image: none;\n      background-color: transparent;\n      color: ${theme.colors.orangeDark};\n      &:focus,\n      :hover {\n        color: ${theme.colors.orangeDark};\n        background-image: none;\n        background-color: transparent;\n      }\n    `,\n    noRightBorderStyle: css`\n      label: noRightBorderStyle;\n      border-right: 0;\n    `,\n    /*\n     * Required top-padding, otherwise is fa-link icon in active state\n     * cut off on top due to fontAwesome icon position\n     */\n    topPadding: css`\n      label: topPadding;\n      padding-top: 1px;\n    `,\n  };\n});\n\ninterface TimeSyncButtonProps {\n  isSynced: boolean;\n  onClick: () => void;\n}\n\nexport function TimeSyncButton(props: TimeSyncButtonProps) {\n  const { onClick, isSynced } = props;\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  const syncTimesTooltip = () => {\n    const { isSynced } = props;\n    const tooltip = isSynced ? 'Unsync all views' : 'Sync all views to this time range';\n    return <>{tooltip}</>;\n  };\n\n  return (\n    <Tooltip content={syncTimesTooltip} placement=\"bottom\">\n      <button\n        className={classNames('btn navbar-button navbar-button--attached', {\n          [`explore-active-button-glow ${styles.timePickerSynced}`]: isSynced,\n        })}\n        aria-label={isSynced ? 'Synced times' : 'Unsynced times'}\n        onClick={() => onClick()}\n      >\n        <i className={classNames('fa fa-link', styles.topPadding, isSynced && 'icon-brand-gradient')} />\n      </button>\n    </Tooltip>\n  );\n}\n","import React, { Component } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\n\nimport { StoreState } from 'app/types';\nimport { ExploreId } from 'app/types/explore';\n\nimport Explore from './Explore';\nimport { CustomScrollbar, ErrorBoundaryAlert } from '@grafana/ui';\nimport { resetExploreAction } from './state/actionTypes';\n\ninterface WrapperProps {\n  split: boolean;\n  resetExploreAction: typeof resetExploreAction;\n}\n\nexport class Wrapper extends Component<WrapperProps> {\n  componentWillUnmount() {\n    this.props.resetExploreAction({});\n  }\n\n  render() {\n    const { split } = this.props;\n\n    return (\n      <div className=\"page-scrollbar-wrapper\">\n        <CustomScrollbar autoHeightMin={'100%'} autoHeightMax={''} className=\"custom-scrollbar--page\">\n          <div className=\"explore-wrapper\">\n            <ErrorBoundaryAlert style=\"page\">\n              <Explore exploreId={ExploreId.left} />\n            </ErrorBoundaryAlert>\n            {split && (\n              <ErrorBoundaryAlert style=\"page\">\n                <Explore exploreId={ExploreId.right} />\n              </ErrorBoundaryAlert>\n            )}\n          </div>\n        </CustomScrollbar>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state: StoreState) => {\n  const { split } = state.explore;\n  return { split };\n};\n\nconst mapDispatchToProps = {\n  resetExploreAction,\n};\n\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(Wrapper));\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\n\nimport { changeRefreshInterval, runQueries } from './state/actions';\nimport { setPausedStateAction } from './state/actionTypes';\nimport { RefreshPicker } from '@grafana/ui';\nimport { ExploreId } from '../../types';\n\n/**\n * Hook that gives you all the functions needed to control the live tailing.\n */\nexport function useLiveTailControls(exploreId: ExploreId) {\n  const dispatch = useDispatch();\n\n  const pause = useCallback(() => {\n    dispatch(setPausedStateAction({ exploreId, isPaused: true }));\n  }, [exploreId, dispatch]);\n\n  const resume = useCallback(() => {\n    dispatch(setPausedStateAction({ exploreId, isPaused: false }));\n  }, [exploreId, dispatch]);\n\n  const stop = useCallback(() => {\n    // We need to pause here first because there is transition where we are not live but live logs are still shown\n    // to cross fade with the normal view. This will prevent reordering of the logs in the live view during the\n    // transition.\n    pause();\n\n    // TODO referencing this from perspective of refresh picker when there is designated button for it now is not\n    //  great. Needs a bit of refactoring.\n    dispatch(changeRefreshInterval(exploreId, RefreshPicker.offOption.value));\n    dispatch(runQueries(exploreId));\n  }, [exploreId, dispatch, pause]);\n\n  const start = useCallback(() => {\n    dispatch(changeRefreshInterval(exploreId, RefreshPicker.liveOption.value));\n  }, [exploreId, dispatch]);\n\n  return {\n    pause,\n    resume,\n    stop,\n    start,\n  };\n}\n\ntype Props = {\n  exploreId: ExploreId;\n  children: (controls: ReturnType<typeof useLiveTailControls>) => React.ReactElement;\n};\n\n/**\n * If you can't use the hook you can use this as a render prop pattern.\n */\nexport function LiveTailControls(props: Props) {\n  const controls = useLiveTailControls(props.exploreId);\n  return props.children(controls);\n}\n","import React from 'react';\nimport memoizeOne from 'memoize-one';\nimport { css } from 'emotion';\nimport { CSSTransition } from 'react-transition-group';\n\nconst transitionDuration = 500;\n// We add a bit of delay to the transition as another perf optimisation. As at the start we need to render\n// quite a bit of new rows, if we start transition at the same time there can be frame rate drop. This gives time\n// for react to first render them and then do the animation.\nconst transitionDelay = 100;\n\nconst getStyles = memoizeOne(() => {\n  return {\n    logsEnter: css`\n      label: logsEnter;\n      position: absolute;\n      opacity: 0;\n      height: auto;\n      width: 100%;\n    `,\n    logsEnterActive: css`\n      label: logsEnterActive;\n      opacity: 1;\n      transition: opacity ${transitionDuration}ms ease-out ${transitionDelay}ms;\n    `,\n    logsExit: css`\n      label: logsExit;\n      position: absolute;\n      opacity: 1;\n      height: auto;\n      width: 100%;\n    `,\n    logsExitActive: css`\n      label: logsExitActive;\n      opacity: 0;\n      transition: opacity ${transitionDuration}ms ease-out ${transitionDelay}ms;\n    `,\n  };\n});\n\ntype Props = {\n  children: React.ReactNode;\n  visible: boolean;\n};\n\n/**\n * Cross fade transition component that is tied a bit too much to the logs containers so not very useful elsewhere\n * right now.\n */\nexport function LogsCrossFadeTransition(props: Props) {\n  const { visible, children } = props;\n  const styles = getStyles();\n  return (\n    <CSSTransition\n      in={visible}\n      mountOnEnter={true}\n      unmountOnExit={true}\n      timeout={transitionDuration + transitionDelay}\n      classNames={{\n        enter: styles.logsEnter,\n        enterActive: styles.logsEnterActive,\n        exit: styles.logsExit,\n        exitActive: styles.logsExitActive,\n      }}\n    >\n      {children}\n    </CSSTransition>\n  );\n}\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACpCA;AACA;AAEA;AAeA;;AAEA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;;AAqCA;AA9CA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC3EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AAYA;AASA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AAGA;AACA;AAwCA;;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AAAA;AAIA;AAAA;AA0CA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AAjHA;;AACA;AAEA;AACA;AAUA;AAEA;AACA;AACA;AAWA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AA6EA;AAAA;;AACA;AAiBA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAMA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAOA;AAEA;AAiBA;AAGA;AAgBA;AAMA;AACA;AAAA;;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC7cA;AACA;AACA;AAEA;AAYA;AAEA;AACA;AASA;AAKA;AAKA;AAwBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAaA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAoBA;AAGA;AAGA;;AAoCA;AAlCA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAOA;AAYA;AAGA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC1LA;AACA;AAIA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAaA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAuBA;AArBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAQA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAMA;AACA;AA0CA;AAAA;AAAA;AAAA;AACA;;AACA;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;;;;AACA;AAWA;AACA;AACA;AACA;AACA;;AAyLA;AAtMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AAAA;AACA;AAsBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAGA;AAEA;AAGA;AAEA;AAKA;AACA;AACA;AAEA;AAMA;AAQA;AAEA;AACA;AAQA;AAcA;AAEA;AACA;AACA;AAGA;AAWA;AAEA;AASA;AAEA;AAaA;AAEA;AAQA;AACA;AAQA;AAGA;AAEA;AAmBA;AACA;AAAA;;AAEA;AAAA;;AACA;AACA;AACA;AAEA;AAeA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;AC3YA;AACA;AACA;AAEA;AAGA;AAEA;AACA;AAYA;AAKA;AAMA;AAPA;AACA;AAKA;AACA;AAOA;AAMA;AAGA;AAGA;AAeA;AAAA;AAKA;AAAA;AAJA;AACA;AACA;AAyCA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5DA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AA2BA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAKA;AACA;AAEA;AAKA;AAKA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;;AAEA;AAEA;AACA;AAEA;AACA;;AAEA;AACA;AAKA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxMA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAIA;AAmBA;AA4BA;AAMA;AAKA;AAMA;AAKA;AACA;AAEA;AACA;AACA;AAWA;;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AAUA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AAMA;;;;;;;;;;;;;;;;;;;;;;;;AClKA;AAEA;AAeA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAiCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAoIA;AAlIA;AAAA;AACA;AAkBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAgBA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AASA;AAIA;AAAA;AAAA;AACA;AAMA;AAgBA;;AAGA;AAMA;AAEA;AACA;AAOA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3QA;AACA;AACA;AACA;AAEA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAgCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AACA;AAEA;AACA;AACA;AAEA;;AACA;;AAuEA;AArEA;AAAA;AACA;AAoBA;AAEA;AACA;AACA;AAcA;AACA;AACA;AA2BA;AACA;AAAA;;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAWA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;AC3MA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAWA;AAMA;AAMA;AASA;;;;;;;;;;;;;;;;;;;;;;;AC7CA;AACA;AAEA;AACA;AACA;AAMA;AACA;AAaA;AAAA;AAAA;;AAqFA;AAhFA;;;;;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;AACA;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAUA;AAEA;AA8BA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAoEA;AAlGA;AACA;AACA;AA8BA;;AACA;AAYA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AAyBA;AAWA;AACA;AAAA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;AC5MA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAYA;AAEA;AASA;AAEA;AAEA;AAKA;AAIA;AACA;AAIA;AACA;AAMA;AAGA;AACA;AACA;AAKA;;;;;;;;;;;;;;;;;;;AC9DA;AACA;AAEA;AACA;AAaA;AAAA;AAAA;;AAWA;AAVA;AACA;AACA;AAGA;AACA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AC5BA;AAEA;AAAA;AACA;AACA;AACA;AAYA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAKA;AACA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;AC1CA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAMA;AACA;AAWA;AACA;AACA;AACA;AAUA;AACA;AAQA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpDA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAYA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAyBA;AAvBA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAKA;AACA;AAAA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AChEA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAaA;AAIA;;;AAGA;AACA;AAIA;AACA;AAOA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAIA;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;AClEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAOA;AAAA;AAAA;;AAyBA;AAxBA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAOA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAGA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACzDA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAOA;AAKA;AAOA;AAKA;AACA;AAOA;;;AAGA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAKA;;;;;;A","sourceRoot":""}